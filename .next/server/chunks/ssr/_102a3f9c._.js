module.exports=[27009,a=>{"use strict";var b=a.i(72131),c=a.i(33217),d=a.i(70025),e=a.i(37927),f=a.i(3159);let g=["article-categories"];async function h(){let a=await fetch("/api/article-categories");if(!a.ok)throw Error("Failed to fetch article categories");return a.json()}async function i(a){let b=await fetch("/api/article-categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:a})});if(!b.ok)throw Error((await b.json().catch(()=>({error:"Failed to create article category"}))).error||"Failed to create article category")}async function j({oldCategory:a,newCategory:b}){let c=await fetch("/api/article-categories",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldCategory:a,newCategory:b})});if(!c.ok)throw Error((await c.json().catch(()=>({error:"Failed to update article category"}))).error||"Failed to update article category")}async function k(a){let b=await fetch(`/api/article-categories?category=${encodeURIComponent(a)}`,{method:"DELETE"});if(!b.ok)throw Error((await b.json().catch(()=>({error:"Failed to delete article category"}))).error||"Failed to delete article category")}function l(){let{setArticleCategories:a}=(0,f.useDataStore)(),d=(0,c.useQuery)({queryKey:g,queryFn:h});return b.default.useEffect(()=>{d.data&&a(d.data)},[d.data,a]),d}function m(){let a=(0,e.useQueryClient)(),{addArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:i,onSuccess:(c,d)=>{b(d),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to create article category:",a)}})}function n(){let a=(0,e.useQueryClient)(),{updateArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:j,onSuccess:(c,d)=>{b(d.oldCategory,d.newCategory),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to update article category:",a)}})}function o(){let a=(0,e.useQueryClient)(),{deleteArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:k,onSuccess:(c,d)=>{b(d),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to delete article category:",a)}})}a.s(["useArticleCategories",()=>l,"useCreateArticleCategory",()=>m,"useDeleteArticleCategory",()=>o,"useUpdateArticleCategory",()=>n])},25362,a=>{"use strict";var b=a.i(72131),c=a.i(33217),d=a.i(3159);let e={all:["articles"],lists:()=>[...e.all,"list"],list:a=>[...e.lists(),{filters:a}],details:()=>[...e.all,"detail"],detail:a=>[...e.details(),a]};async function f(){let a=await fetch("/api/articles");if(!a.ok)throw Error("Failed to fetch articles");return a.json()}async function g(a){let b=new URLSearchParams;a.page&&b.append("page",a.page.toString()),a.limit&&b.append("limit",a.limit.toString()),a.search&&b.append("search",a.search),a.category&&b.append("category",a.category),a.status&&b.append("status",a.status);let c=await fetch(`/api/articles?${b.toString()}`);if(!c.ok)throw Error("Failed to fetch articles");return c.json()}function h(){let{setArticles:a}=(0,d.useDataStore)(),g=(0,c.useQuery)({queryKey:e.all,queryFn:f});return b.default.useEffect(()=>{g.data&&a(g.data)},[g.data,a]),g}function i(a){return(0,c.useQuery)({queryKey:[...e.all,"paginated",a],queryFn:()=>g(a)})}a.s(["useArticles",()=>h,"useArticlesPaginated",()=>i])},210,a=>{"use strict";let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},16424,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97292),e=a.i(68851),f=a.i(32636),g=a.i(50944),h=a.i(210),i=a.i(14548),j=a.i(33508),k=a.i(99570),l=a.i(66718),m=a.i(29246),n=a.i(70430),o=a.i(80701),p=a.i(97651),q=a.i(26632),r=a.i(23292);function s(){let{updateArticle:a}=(0,e.useData)(),{isAdmin:s,isLoading:t}=(0,f.useAuth)(),u=(0,g.useRouter)(),v=(0,g.useParams)().id,[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)("published"),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!0),[M,N]=(0,c.useState)({}),{articleCategories:O}=(0,e.useData)();if((0,c.useEffect)(()=>{v&&(async()=>{L(!0);try{let a=await fetch("/api/articles");if(!a.ok)throw Error("Failed to fetch article");let b=(await a.json()).find(a=>a.id===v);b?(x(b.title),z(b.category||""),B(b.summary||""),D(b.content||""),F(b.imageUrl||""),H(b.status||"published")):(r.toast.error("Không tìm thấy bài viết"),u.push("/admin/articles"))}catch(a){console.error("Error fetching article:",a),r.toast.error("Không thể tải bài viết"),u.push("/admin/articles")}finally{L(!1)}})()},[v,u]),t||K)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!s)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)(k.Button,{onClick:()=>u.push("/login"),children:"Đăng nhập với tài khoản Admin"})]})})});let P=async b=>{let c;if(b.preventDefault(),c={},w&&w.trim()||(c.title="Tiêu đề bài viết là bắt buộc"),C&&C.trim()&&"<p></p>"!==C||(c.content="Nội dung bài viết là bắt buộc"),E&&E.trim()||(c.imageUrl="Hình ảnh bài viết là bắt buộc"),y&&y.trim()||(c.category="Chuyên mục là bắt buộc"),N(c),0!==Object.keys(c).length)return void r.toast.error("Vui lòng điền đầy đủ các trường bắt buộc");J(!0);try{if(!(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:v,title:w.trim(),summary:A.trim()||void 0,content:C.trim(),imageUrl:E.trim(),category:y.trim(),status:G})})).ok)throw Error("Failed to update article");await a(v,{title:w.trim(),summary:A.trim()||void 0,content:C.trim(),imageUrl:E.trim(),category:y.trim(),status:G}),r.toast.success("Cập nhật bài viết thành công!"),u.push("/admin/articles")}catch(a){console.error("Error updating article:",a),r.toast.error("Đã có lỗi xảy ra khi cập nhật bài viết.")}finally{J(!1)}},Q=async()=>{if(w||C||A||E)try{(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:v,title:w.trim()||void 0,summary:A.trim()||void 0,content:C.trim()||void 0,imageUrl:E.trim()||void 0,category:y.trim()||void 0,status:"draft"})})).ok&&(await a(v,{status:"draft"}),r.toast.success("Đã lưu bản nháp!"))}catch(a){console.error("Error saving draft:",a),r.toast.error("Không thể lưu bản nháp")}u.push("/admin/articles")};return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",onClick:Q,children:(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Chỉnh sửa bài viết"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Cập nhật thông tin và nội dung bài viết"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:Q,disabled:I,children:[(0,b.jsx)(j.X,{className:"h-4 w-4 mr-2"}),"Hủy"]}),(0,b.jsxs)(k.Button,{onClick:P,disabled:I,children:[(0,b.jsx)(i.Save,{className:"h-4 w-4 mr-2"}),I?"Đang lưu...":"Lưu bài viết"]})]})]}),(0,b.jsx)("form",{onSubmit:P,className:"space-y-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"title",children:"Tiêu đề bài viết *"}),(0,b.jsx)(l.Input,{id:"title",type:"text",required:!0,value:w,onChange:a=>{x(a.target.value),M.title&&N(a=>({...a,title:""}))},placeholder:"Nhập tiêu đề bài viết...",className:`text-lg ${M.title?"border-red-500":""}`}),M.title&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:M.title})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"content",children:"Nội dung bài viết *"}),(0,b.jsx)("div",{className:M.content?"border border-red-500 rounded-md":"",children:(0,b.jsx)(q.RichTextEditor,{content:C,onChange:a=>{D(a),M.content&&N(a=>({...a,content:""}))},placeholder:"Nhập nội dung bài viết...",className:"min-h-[500px]"})}),M.content&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:M.content})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"category",children:"Chuyên mục *"}),(0,b.jsxs)(o.Select,{value:y,onValueChange:a=>{z(a),M.category&&N(a=>({...a,category:""}))},children:[(0,b.jsx)(o.SelectTrigger,{id:"category",className:M.category?"border-red-500":"",children:(0,b.jsx)(o.SelectValue,{placeholder:"Chọn chuyên mục..."})}),(0,b.jsx)(o.SelectContent,{children:O.map(a=>(0,b.jsx)(o.SelectItem,{value:a,children:a},a))})]}),M.category&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:M.category})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"summary",children:"Mô tả ngắn"}),(0,b.jsx)(m.Textarea,{id:"summary",value:A,onChange:a=>B(a.target.value),rows:4,placeholder:"Nhập mô tả ngắn về bài viết..."}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Mô tả này sẽ được hiển thị trong danh sách bài viết"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"image",children:"Hình ảnh bài viết *"}),(0,b.jsx)(p.default,{maxFiles:1,maxSize:5242880,accept:"image/*",multiple:!1,onFilesChange:a=>{if(a.length>0&&"completed"===a[0].status){let b=a[0].file;b instanceof File?(F(URL.createObjectURL(b)),M.imageUrl&&N(a=>({...a,imageUrl:""}))):"url"in b&&b.url&&(F(b.url),M.imageUrl&&N(a=>({...a,imageUrl:""})))}else 0===a.length&&F("")},simulateUpload:!0}),(0,b.jsx)(l.Input,{id:"image",type:"text",value:E,onChange:a=>{F(a.target.value),M.imageUrl&&N(a=>({...a,imageUrl:""}))},placeholder:"Hoặc nhập URL hình ảnh",className:`mt-2 ${M.imageUrl?"border-red-500":""}`}),M.imageUrl&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:M.imageUrl})]})]})]})})]})})}a.s(["default",()=>s])}];

//# sourceMappingURL=_102a3f9c._.js.map