module.exports=[53854,a=>{"use strict";var b=a.i(72131),c=a.i(33217),d=a.i(3159);let e={all:["practices"],lists:()=>[...e.all,"list"],list:a=>[...e.lists(),{filters:a}],details:()=>[...e.all,"detail"],detail:a=>[...e.details(),a]};async function f(){let a=await fetch("/api/practices");if(!a.ok)throw Error("Failed to fetch practices");return a.json()}function g(){let{setPractices:a}=(0,d.useDataStore)(),g=(0,c.useQuery)({queryKey:e.all,queryFn:f});return b.default.useEffect(()=>{g.data&&a(g.data)},[g.data,a]),g}a.s(["practiceKeys",0,e,"usePractices",()=>g])},53722,a=>{"use strict";let b=(0,a.i(70106).default)("book-open",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);a.s(["BookOpen",()=>b],53722)},5221,a=>{"use strict";var b=a.i(72131),c=a.i(33217),d=a.i(3159);let e={all:["books"],lists:()=>[...e.all,"list"],list:a=>[...e.lists(),{filters:a}],details:()=>[...e.all,"detail"],detail:a=>[...e.details(),a]};async function f(){let a=await fetch("/api/books");if(!a.ok)throw Error("Failed to fetch books");return a.json()}function g(){let{setBooks:a}=(0,d.useDataStore)(),g=(0,c.useQuery)({queryKey:e.all,queryFn:f});return b.default.useEffect(()=>{g.data&&a(g.data)},[g.data,a]),g}a.s(["bookKeys",0,e,"useBooks",()=>g])},63588,a=>{"use strict";let b=(0,a.i(70106).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);a.s(["MessageSquare",()=>b],63588)},58993,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97292),e=a.i(5221),f=a.i(53854),g=a.i(32636),h=a.i(50944),i=a.i(68114);let j=c.createContext(void 0);function k({defaultValue:a,value:d,onValueChange:e,children:f,className:g}){let[h,k]=c.useState(a||""),l=void 0!==d,m=l?d:h,n=c.useCallback(a=>{l||k(a),e?.(a)},[l,e]);return(0,b.jsx)(j.Provider,{value:{value:m,onValueChange:n},children:(0,b.jsx)("div",{className:(0,i.cn)("w-full",g),children:f})})}function l({children:a,className:c}){return(0,b.jsx)("div",{className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-slate-100 p-1 text-slate-500",c),children:a})}function m({value:a,children:d,className:e}){let f=c.useContext(j);if(!f)throw Error("TabsTrigger must be used within Tabs");let g=f.value===a;return(0,b.jsx)("button",{type:"button",onClick:()=>f.onValueChange(a),className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",g?"bg-white text-slate-950 shadow-sm":"text-slate-600 hover:text-slate-950",e),children:d})}function n({value:a,children:d,className:e}){let f=c.useContext(j);if(!f)throw Error("TabsContent must be used within Tabs");return f.value!==a?null:(0,b.jsx)("div",{className:(0,i.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2",e),children:d})}let o=(0,a.i(70106).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var p=a.i(50522),q=a.i(99570);function r(){let a,{data:i=[]}=(0,e.useBooks)(),{data:j=[]}=(0,f.usePractices)(),{isAdmin:r,isLoading:s}=(0,g.useAuth)(),t=(0,h.useRouter)(),u=(0,h.useSearchParams)(),v="books"===(a=u.get("tab"))||"practices"===a?a:"books",w=(()=>{let a=u.get("page");if(a){let b=parseInt(a,10);return!isNaN(b)&&b>0?b:1}return 1})(),[x,y]=(0,c.useState)(v),[z,A]=(0,c.useState)(w),B=(0,c.useRef)(!1),C=(0,c.useRef)(!0),D=(0,c.useMemo)(()=>(i||[]).flatMap(a=>(a.comments||[]).map(b=>({...b,sourceTitle:a.title,sourceId:a.id,sourceType:"book"}))),[i]),E=(0,c.useMemo)(()=>(j||[]).flatMap(a=>(a.comments||[]).map(b=>({...b,sourceTitle:a.title,sourceId:a.id,sourceType:"practice"}))),[j]),F=a=>[...a].sort((a,b)=>{let c=new Date(a.date).getTime();return new Date(b.date).getTime()-c}),G=(0,c.useMemo)(()=>F(D),[D]),H=(0,c.useMemo)(()=>F(E),[E]),I="books"===x?G:H;(0,c.useEffect)(()=>{if(B.current){B.current=!1;return}let a=u.get("tab"),b=u.get("page");if(("books"===a||"practices"===a)&&a!==x&&y(a),b){let a=parseInt(b,10);!isNaN(a)&&a>0&&a!==z&&A(a)}else 1===z||C.current||A(1)},[u]),(0,c.useEffect)(()=>{let a=u.get("commentId");if(!a)return;let b=("practices"===(u.get("tab")||"books")?H:G).findIndex(b=>b.id===a);if(b>=0){let c=Math.floor(b/10)+1;c!==z&&A(c),setTimeout(()=>{let b=document.getElementById(`comment-${a}`);b&&(b.scrollIntoView({behavior:"smooth",block:"center"}),b.classList.add("ring-2","ring-blue-500","ring-offset-2"),setTimeout(()=>{b.classList.remove("ring-2","ring-blue-500","ring-offset-2")},2e3))},100)}},[u.get("commentId"),G,H]);let J=Math.ceil(I.length/10),K=(z-1)*10,L=K+10,M=I.slice(K,L),N=c.default.useCallback(a=>{let b=new URLSearchParams(u.toString());void 0!==a.tab&&("books"===a.tab?b.delete("tab"):b.set("tab",a.tab)),void 0!==a.page&&(a.page>1?b.set("page",a.page.toString()):b.delete("page")),void 0!==a.commentId&&(a.commentId?b.set("commentId",a.commentId):b.delete("commentId")),t.replace(`/admin/comments?${b.toString()}`,{scroll:!1})},[u,t]);if((0,c.useEffect)(()=>{if(C.current){C.current=!1;return}B.current=!0,N({tab:x,page:z})},[x,z]),s)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!r)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)("button",{onClick:()=>t.push("/login"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:"Đăng nhập với tài khoản Admin"})]})})});let O=a=>{try{let b=new Date(a);if(a.includes("T")||a.includes(" "))return b.toLocaleString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return b.toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})}catch{return a}};return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Bình luận & Phản hồi"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Quản lý tất cả bình luận từ độc giả"})]}),(0,b.jsxs)(k,{value:x,onValueChange:a=>{a!==x&&(y(a),A(1))},children:[(0,b.jsxs)(l,{children:[(0,b.jsxs)(m,{value:"books",children:["Bình luận bài viết (",D.length,")"]}),(0,b.jsxs)(m,{value:"practices",children:["Bình luận tập luyện (",E.length,")"]})]}),(0,b.jsx)(n,{value:"books",children:(0,b.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-6",children:0===G.length?(0,b.jsx)("p",{className:"text-slate-500 mt-4",children:"Chưa có bình luận nào từ bài viết."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("p",{className:"text-slate-600",children:["Tổng số bình luận: ",G.length," | Trang ",z," / ",J]})}),(0,b.jsx)("div",{className:"mt-4 space-y-4",children:M.map(a=>(0,b.jsxs)("div",{id:`comment-${a.id}`,className:"p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:a.user}),(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full",children:"Bài viết"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:a.sourceTitle})]}),(0,b.jsx)("span",{className:"text-xs text-slate-500 whitespace-nowrap ml-4",children:O(a.date)})]}),(0,b.jsx)("p",{className:"text-slate-700 mt-2",children:a.content})]},a.id))}),J>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-slate-200",children:[(0,b.jsxs)("div",{className:"text-sm text-slate-600",children:["Hiển thị ",K+1,"-",Math.min(L,I.length)," trong tổng số ",I.length," bình luận"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>A(a=>Math.max(1,a-1)),disabled:1===z,className:"cursor-pointer",children:[(0,b.jsx)(o,{className:"h-4 w-4"}),"Trước"]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:J},(a,b)=>b+1).map(a=>1===a||a===J||a>=z-1&&a<=z+1?(0,b.jsx)(q.Button,{variant:z===a?"default":"outline",size:"sm",onClick:()=>A(a),className:"cursor-pointer min-w-[2.5rem]",children:a},a):a===z-2||a===z+2?(0,b.jsx)("span",{className:"px-2",children:"..."},a):null)}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>A(a=>Math.min(J,a+1)),disabled:z===J,className:"cursor-pointer",children:["Sau",(0,b.jsx)(p.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})}),(0,b.jsx)(n,{value:"practices",children:(0,b.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-slate-200 p-6",children:0===H.length?(0,b.jsx)("p",{className:"text-slate-500 mt-4",children:"Chưa có bình luận nào từ tập luyện."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("p",{className:"text-slate-600",children:["Tổng số bình luận: ",H.length," | Trang ",z," / ",J]})}),(0,b.jsx)("div",{className:"mt-4 space-y-4",children:M.map(a=>(0,b.jsxs)("div",{id:`comment-${a.id}`,className:"p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:a.user}),(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 bg-purple-100 text-purple-700 rounded-full",children:"Tập luyện"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-600",children:a.sourceTitle})]}),(0,b.jsx)("span",{className:"text-xs text-slate-500 whitespace-nowrap ml-4",children:O(a.date)})]}),(0,b.jsx)("p",{className:"text-slate-700 mt-2",children:a.content})]},a.id))}),J>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-4 border-t border-slate-200",children:[(0,b.jsxs)("div",{className:"text-sm text-slate-600",children:["Hiển thị ",K+1,"-",Math.min(L,I.length)," trong tổng số ",I.length," bình luận"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>A(a=>Math.max(1,a-1)),disabled:1===z,className:"cursor-pointer",children:[(0,b.jsx)(o,{className:"h-4 w-4"}),"Trước"]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:J},(a,b)=>b+1).map(a=>1===a||a===J||a>=z-1&&a<=z+1?(0,b.jsx)(q.Button,{variant:z===a?"default":"outline",size:"sm",onClick:()=>A(a),className:"cursor-pointer min-w-[2.5rem]",children:a},a):a===z-2||a===z+2?(0,b.jsx)("span",{className:"px-2",children:"..."},a):null)}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>A(a=>Math.min(J,a+1)),disabled:z===J,className:"cursor-pointer",children:["Sau",(0,b.jsx)(p.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})})]})]})})}function s(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})}),children:(0,b.jsx)(r,{})})}a.s(["default",()=>s],58993)}];

//# sourceMappingURL=_d83d3e97._.js.map