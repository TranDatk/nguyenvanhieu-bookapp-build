module.exports=[90438,a=>{"use strict";var b=a.i(51112),c=a.i(14206),d=a.i(7879),e=a.i(59485),f=a.i(67759),g=a.i(36491),h=a.i(86767),i=a.i(10758),j=a.i(7283),k=a.i(49027),l=a.i(72385),m=a.i(71728),n=a.i(63405),o=a.i(13218),p=a.i(95499),q=a.i(91140),r=a.i(30935),s=a.i(43216),t=a.i(3272),u=a.i(86453);let v=(0,u.createServerReference)("40eb73ecd3fcd6e3cc3a61d3d11e825c574bfbaa1c",u.callServer,void 0,u.findSourceMapURL,"createPractice"),w=(0,u.createServerReference)("605ffda2d0de875359194f48f39125f3175b2d3be3",u.callServer,void 0,u.findSourceMapURL,"updatePracticeAction"),x=(0,u.createServerReference)("40a2b85ef22f47d5fc277a26855437b420218fa670",u.callServer,void 0,u.findSourceMapURL,"deletePracticeAction");function y(){let{isAdmin:a,isLoading:u}=(0,e.useAuth)(),y=(0,f.useRouter)(),z=(0,f.useSearchParams)(),A=z.get("action"),B=z.get("id"),C="create"===A||"edit"===A,D="edit"===A&&B,[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(0),[I,J]=(0,c.useState)(0),[K,L]=(0,c.useState)(!0),M=z.get("search")||"",N=(()=>{let a=z.get("page");if(a){let b=parseInt(a,10);return!isNaN(b)&&b>0?b:1}return 1})(),[O,P]=(0,c.useState)(M),[Q,R]=(0,c.useState)(M),[S,T]=(0,c.useState)(N),U=(0,c.useRef)(!1),V=(0,c.useRef)(!0),[W,X]=(0,c.useState)(null),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(null),aa=(0,c.useRef)(null),ab=(0,c.useRef)(null),ac=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(U.current){U.current=!1;return}let a=z.get("search")||"",b=z.get("page");if(a!==Q&&(P(a),R(a)),b){let a=parseInt(b,10);!isNaN(a)&&a>0&&a!==S&&T(a)}else 1===S||V.current||T(1)},[z]);let ad=c.default.useCallback(a=>{let b=new URLSearchParams(z.toString());A&&b.set("action",A),B&&b.set("id",B),void 0!==a.search&&(a.search?b.set("search",a.search):b.delete("search")),void 0!==a.page&&(a.page>1?b.set("page",a.page.toString()):b.delete("page")),y.replace(`/admin/practices?${b.toString()}`,{scroll:!1})},[z,y,A,B]),ae=c.default.useCallback(async()=>{L(!0);try{let a=new URLSearchParams({page:S.toString(),limit:"10"});Q&&a.append("search",Q);let b=await fetch(`/api/practices?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch practices");let c=await b.json();F(c.practices||[]),H(c.total||0),J(c.totalPages||0)}catch(a){m.toast.error("Không thể tải danh sách bài tập luyện")}finally{L(!1)}},[S,Q]);(0,c.useEffect)(()=>{ae()},[ae]),(0,c.useEffect)(()=>{if(V.current){V.current=!1;return}U.current=!0,ad({search:Q,page:S})},[S,Q]);let af=()=>{R(O),T(1)},ag=D&&B?E.find(a=>a.id===B):null,[ah,ai,aj]=(0,c.useActionState)(async(a,b)=>await v(b),null),[ak,al,am]=(0,c.useActionState)(async(a,b)=>B?await w(B,b):{success:!1,error:"Practice ID is required"},null);if((0,c.useEffect)(()=>{if(ah){let a=JSON.stringify(ah)+Date.now();ab.current!==a&&(ab.current=a,ah.success?(m.toast.success("Thêm bài tập luyện thành công!"),ae().then(()=>{y.refresh(),an(),setTimeout(()=>{ab.current=null},100)})):ah.error&&m.toast.error("Đã có lỗi xảy ra khi thêm bài tập luyện."))}},[ah]),(0,c.useEffect)(()=>{if(ak){let a=JSON.stringify(ak)+Date.now();ac.current!==a&&(ac.current=a,ak.success?(m.toast.success("Cập nhật bài tập luyện thành công!"),ae().then(()=>{y.refresh(),an(),setTimeout(()=>{ac.current=null},100)})):ak.error&&m.toast.error("Đã có lỗi xảy ra khi cập nhật bài tập luyện."))}},[ak]),u)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!a)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)("button",{onClick:()=>y.push("/login"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:"Đăng nhập với tài khoản Admin"})]})})});let an=()=>{aa.current?.reset(),ab.current=null,ac.current=null,y.push("/admin/practices")},ao=async a=>{Z(!0);let b=1===E.length;try{let c=await x(a);c.success?(await ae(),b&&S>1&&T(a=>Math.max(1,a-1)),y.refresh(),X(null),m.toast.success("Xóa bài tập luyện thành công!")):(m.toast.error(c.error||"Đã có lỗi xảy ra khi xóa bài tập luyện."),X(null))}catch(a){console.error("Error deleting practice:",a),m.toast.error("Đã có lỗi xảy ra khi xóa bài tập luyện."),X(null)}finally{Z(!1)}};return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900",children:"Quản lý tập luyện"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Danh sách và quản lý các bài tập luyện trên hệ thống"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(g.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:20}),(0,b.jsx)(o.Input,{type:"text",placeholder:"Tìm kiếm theo tiêu đề hoặc mô tả...",value:O,onChange:a=>P(a.target.value),onKeyPress:a=>{"Enter"===a.key&&af()},className:"pl-10"})]}),(0,b.jsxs)(n.Button,{onClick:af,variant:"outline",className:"w-full sm:w-auto",children:[(0,b.jsx)(g.Search,{size:18,className:"mr-2"}),"Tìm kiếm"]}),Q&&(0,b.jsx)(n.Button,{onClick:()=>{P(""),R(""),T(1)},variant:"outline",className:"w-full sm:w-auto",children:"Bỏ tìm kiếm"})]}),(0,b.jsx)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:(0,b.jsxs)(n.Button,{onClick:()=>y.push("/admin/practices?action=create"),className:"w-full sm:w-auto",children:[(0,b.jsx)(h.Plus,{size:18}),(0,b.jsx)("span",{className:"ml-2",children:"Thêm bài tập luyện mới"})]})})]}),(0,b.jsxs)(t.Card,{children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(r.Table,{children:[(0,b.jsx)(r.TableHeader,{children:(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableHead,{children:"Tiêu đề"}),(0,b.jsx)(r.TableHead,{className:"hidden md:table-cell max-w-xs",children:"Mô tả"}),(0,b.jsx)(r.TableHead,{className:"hidden lg:table-cell",children:"Ngày tạo"}),(0,b.jsx)(r.TableHead,{className:"text-right",children:"Hành động"})]})}),(0,b.jsx)(r.TableBody,{children:K?(0,b.jsx)(r.TableRow,{children:(0,b.jsx)(r.TableCell,{colSpan:4,className:"text-center py-8",children:(0,b.jsxs)("div",{className:"flex items-center justify-center",children:[(0,b.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,b.jsx)("span",{className:"ml-2 text-slate-600",children:"Đang tải..."})]})})}):0===E.length?(0,b.jsx)(r.TableRow,{children:(0,b.jsx)(r.TableCell,{colSpan:4,className:"text-center py-8 text-slate-500",children:Q?"Không tìm thấy kết quả":"Chưa có bài tập luyện nào"})}):E.map(a=>(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableCell,{children:(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"font-medium text-slate-900 text-sm sm:text-base",children:a.title})})}),(0,b.jsx)(r.TableCell,{className:"hidden md:table-cell max-w-xs",children:(0,b.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 line-clamp-2 break-words",children:a.description})}),(0,b.jsx)(r.TableCell,{className:"text-xs sm:text-sm text-slate-600 hidden lg:table-cell",children:new Date(a.publishDate).toLocaleDateString("vi-VN")}),(0,b.jsx)(r.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",title:"Xem",onClick:()=>_(a),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(i.Eye,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",title:"Sửa",onClick:()=>y.push(`/admin/practices?action=edit&id=${a.id}`),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(j.Edit,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:()=>X(a.id),title:"Xóa",className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(k.Trash2,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"px-4 sm:px-6 py-4 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 text-center sm:text-left",children:G>0?(0,b.jsxs)(b.Fragment,{children:["Hiển thị ",(S-1)*10+1,"-",Math.min(10*S,G)," trên ",G," kết quả"]}):(0,b.jsx)(b.Fragment,{children:"Không có kết quả"})}),I>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Button,{variant:"outline",size:"icon",disabled:1===S,onClick:()=>T(a=>Math.max(1,a-1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"←"}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:I},(a,b)=>b+1).map(a=>1===a||a===I||a>=S-1&&a<=S+1?(0,b.jsx)(n.Button,{size:"sm",variant:S===a?"default":"outline",onClick:()=>T(a),className:"h-8 px-3 sm:h-9 sm:px-4 cursor-pointer ",children:a},a):a===S-2||a===S+2?(0,b.jsx)("span",{className:"px-2 text-slate-500",children:"..."},a):null)}),(0,b.jsx)(n.Button,{variant:"outline",size:"icon",disabled:S===I,onClick:()=>T(a=>Math.min(I,a+1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"→"})]})]})]}),(0,b.jsx)(s.Dialog,{open:C,onOpenChange:a=>!a&&!aj&&!am&&an(),children:(0,b.jsxs)(s.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(s.DialogHeader,{children:[(0,b.jsx)(s.DialogTitle,{children:D?"Chỉnh sửa bài tập luyện":"Thêm bài tập luyện mới"}),(0,b.jsx)(s.DialogDescription,{children:D?"Cập nhật thông tin bài tập luyện":"Điền thông tin để thêm bài tập luyện mới"})]}),(0,b.jsxs)("form",{ref:aa,action:D?al:ai,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{htmlFor:"title",children:"Tiêu đề bài tập luyện *"}),(0,b.jsx)(o.Input,{id:"title",name:"title",type:"text",required:!0,defaultValue:ag?.title||"",placeholder:"Ví dụ: Bài tập thể dục buổi sáng"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{htmlFor:"description",children:"Mô tả *"}),(0,b.jsx)(p.Textarea,{id:"description",name:"description",required:!0,defaultValue:ag?.description||"",rows:4,placeholder:"Nhập mô tả về bài tập luyện..."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(q.Label,{htmlFor:"videoUrl",children:"URL Video (TikTok hoặc YouTube) *"}),(0,b.jsx)(o.Input,{id:"videoUrl",name:"videoUrl",type:"url",required:!0,defaultValue:ag?.videoUrl||"",placeholder:"https://www.youtube.com/watch?v=... hoặc https://www.tiktok.com/..."}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Hỗ trợ link YouTube hoặc TikTok"})]}),(0,b.jsxs)(s.DialogFooter,{children:[(0,b.jsx)(n.Button,{type:"button",variant:"outline",onClick:an,disabled:aj||am,children:"Hủy bỏ"}),(0,b.jsx)(n.Button,{type:"submit",disabled:aj||am,children:aj||am?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),D?"Đang cập nhật...":"Đang lưu..."]}):D?"Cập nhật":"Lưu bài tập luyện"})]})]})]})}),(0,b.jsx)(s.Dialog,{open:!!$,onOpenChange:a=>!a&&_(null),children:(0,b.jsxs)(s.DialogContent,{className:"w-[95vw] sm:w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(s.DialogHeader,{children:[(0,b.jsx)(s.DialogTitle,{children:"Thông tin bài tập luyện"}),(0,b.jsx)(s.DialogDescription,{children:"Chi tiết thông tin của bài tập luyện"})]}),$&&(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:$.title}),(0,b.jsxs)("p",{className:"text-sm text-slate-500 mb-4",children:["Ngày đăng: ",new Date($.publishDate).toLocaleDateString("vi-VN")]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-slate-900 mb-2",children:"Mô tả"}),(0,b.jsx)("p",{className:"text-slate-700 leading-relaxed whitespace-pre-line",children:$.description})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-slate-900 mb-2",children:"Video"}),(0,b.jsx)("div",{className:"aspect-video bg-slate-100 rounded-lg overflow-hidden",children:$.videoUrl.includes("youtube.com")||$.videoUrl.includes("youtu.be")?(0,b.jsx)("iframe",{src:(a=>{if(a.includes("youtube.com/watch")||a.includes("youtu.be/")){let b=a.includes("youtu.be/")?a.split("youtu.be/")[1].split("?")[0]:a.split("v=")[1]?.split("&")[0];return`https://www.youtube.com/embed/${b}`}return a.includes("tiktok.com"),a})($.videoUrl),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,b.jsxs)("a",{href:$.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700",children:[(0,b.jsx)(l.ExternalLink,{size:20}),(0,b.jsxs)("span",{children:["Xem video trên ",$.videoUrl.includes("tiktok")?"TikTok":"trang gốc"]})]})})})]})]}),(0,b.jsxs)(s.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>_(null),children:"Đóng"}),$&&(0,b.jsx)(n.Button,{asChild:!0,children:(0,b.jsxs)("a",{href:$.videoUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,b.jsx)(l.ExternalLink,{size:18,className:"mr-2"}),"Mở video"]})})]})]})}),(0,b.jsx)(s.Dialog,{open:!!W,onOpenChange:a=>!a&&!Y&&X(null),children:(0,b.jsxs)(s.DialogContent,{children:[(0,b.jsxs)(s.DialogHeader,{children:[(0,b.jsx)(s.DialogTitle,{children:"Xác nhận xóa"}),(0,b.jsx)(s.DialogDescription,{children:"Bạn có chắc chắn muốn xóa bài tập luyện này? Hành động này không thể hoàn tác."})]}),(0,b.jsxs)(s.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>X(null),disabled:Y,children:"Hủy"}),(0,b.jsx)(n.Button,{variant:"destructive",onClick:()=>W&&ao(W),disabled:Y,children:Y?"Đang xóa...":"Xóa"})]})]})})]})})}function z(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})}),children:(0,b.jsx)(y,{})})}a.s(["default",()=>z],90438)}];

//# sourceMappingURL=Desktop_nguyenvanhieu-bookapp_src_app_admin_practices_page_tsx_f511e8ef._.js.map