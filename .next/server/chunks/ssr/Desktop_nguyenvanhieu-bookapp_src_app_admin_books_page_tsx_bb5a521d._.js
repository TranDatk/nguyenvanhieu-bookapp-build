module.exports=[13082,a=>{"use strict";var b=a.i(51112),c=a.i(14206),d=a.i(7879),e=a.i(59485),f=a.i(42396),g=a.i(67759),h=a.i(36491),i=a.i(86767),j=a.i(10758),k=a.i(7283),l=a.i(49027),m=a.i(10152),n=a.i(46751),o=a.i(75593),p=a.i(71728),q=a.i(63405),r=a.i(13218),s=a.i(95499),t=a.i(91140),u=a.i(88783),v=a.i(86453);let w=(0,v.createServerReference)("40383b5e36610f61e867900b98b39d8e80d9f8e1ff",v.callServer,void 0,v.findSourceMapURL,"createBook"),x=(0,v.createServerReference)("60fac9b789eb8b6d815f4d0200c9545b83d0db18e9",v.callServer,void 0,v.findSourceMapURL,"updateBookAction"),y=(0,v.createServerReference)("40f441bbe7c8c41a3003294950dd1f8c15f0ea9ebd",v.callServer,void 0,v.findSourceMapURL,"deleteBookAction");var z=a.i(56575),A=a.i(34386),B=a.i(30935),C=a.i(43216),D=a.i(46919),E=a.i(3272);function F(){let{isAdmin:a,isLoading:v}=(0,e.useAuth)(),F=(0,g.useRouter)(),G=(0,g.useSearchParams)(),H=G.get("action"),I=G.get("id"),J="create"===H||"edit"===H,K="edit"===H&&I,[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(0),[P,Q]=(0,c.useState)(0),[R,S]=(0,c.useState)(!0),T=G.get("search")||"",U=G.get("category")||"all",V=(()=>{let a=G.get("page");if(a){let b=parseInt(a,10);return!isNaN(b)&&b>0?b:1}return 1})(),[W,X]=(0,c.useState)(T),[Y,Z]=(0,c.useState)(T),[$,_]=(0,c.useState)(U),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)(!1),[ae,af]=(0,c.useState)(null),[ag,ah]=(0,c.useState)(V),ai=(0,c.useRef)(!1),aj=(0,c.useRef)(!0);(0,c.useEffect)(()=>{if(ai.current){ai.current=!1;return}let a=G.get("search")||"",b=G.get("category")||"all",c=G.get("page");if(a!==Y&&(X(a),Z(a)),b!==$&&_(b),c){let a=parseInt(c,10);!isNaN(a)&&a>0&&a!==ag&&ah(a)}else 1===ag||aj.current||ah(1)},[G]);let ak=c.default.useCallback(a=>{let b=new URLSearchParams(G.toString());H&&b.set("action",H),I&&b.set("id",I),void 0!==a.search&&(a.search?b.set("search",a.search):b.delete("search")),void 0!==a.category&&(a.category&&"all"!==a.category?b.set("category",a.category):b.delete("category")),void 0!==a.page&&(a.page>1?b.set("page",a.page.toString()):b.delete("page")),F.replace(`/admin/books?${b.toString()}`,{scroll:!1})},[G,F,H,I]),al=c.default.useCallback(async()=>{S(!0);try{let a=new URLSearchParams({page:ag.toString(),limit:"10"});Y&&a.append("search",Y),$&&"all"!==$&&a.append("category",$);let b=await fetch(`/api/books?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch books");let c=await b.json();M(c.books||[]),O(c.total||0),Q(c.totalPages||0)}catch(a){console.error("Error fetching books:",a),p.toast.error("Không thể tải danh sách sách")}finally{S(!1)}},[ag,Y,$]);(0,c.useEffect)(()=>{al()},[al]),(0,c.useEffect)(()=>{if(aj.current){aj.current=!1;return}ai.current=!0,ak({search:Y,category:$,page:ag})},[ag,Y,$]);let am=()=>{Z(W),ah(1)},[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(null),[at,au]=(0,c.useState)(""),[av,aw]=(0,c.useState)(""),[ax,ay]=(0,c.useState)(null),{data:az=[]}=(0,f.useBookCategories)(),aA=(0,f.useCreateBookCategory)(),aB=(0,f.useUpdateBookCategory)(),aC=(0,f.useDeleteBookCategory)(),[aD,aE]=(0,c.useState)(""),[aF,aG]=(0,c.useState)(""),[aH,aI]=(0,c.useState)(""),[aJ,aK]=(0,c.useState)(""),[aL,aM]=(0,c.useState)(""),[aN,aO]=(0,c.useState)(!1),[aP,aQ]=(0,c.useState)(!1),[aR,aS]=(0,c.useState)(""),[aT,aU]=(0,c.useState)({});(0,c.useEffect)(()=>{if(!aL||aN)return;let a=async()=>{try{let a=await fetch(`/api/process-pdf?fileId=${encodeURIComponent(aL)}`),b=await a.json();"completed"===b.status?(aO(!0),p.toast.success("PDF đã sẵn sàng! Bạn có thể xuất bản sách ngay")):"failed"===b.status&&(aO(!0),p.toast.error("PDF xử lý thất bại, nhưng bạn vẫn có thể thử tạo sách"))}catch(a){console.error("Error polling PDF processing status:",a)}};a();let b=setInterval(a,2e3);return()=>clearInterval(b)},[aL,aN]);let aV=(0,c.useRef)(null),aW=(0,c.useRef)(null),aX=(0,c.useRef)(null);(0,c.useEffect)(()=>{aW.current=null,aX.current=null},[J]);let aY=K&&I?L.find(a=>a.id===I):null;(0,c.useEffect)(()=>{aY?(aK(aY.coverUrl||""),aI(aY.pdfUrl||""),aE(aY.coverUrl||""),aG(aY.pdfUrl||""),aS(aY.category||"")):(aK(""),aI(""),aE(""),aG(""),aS(""))},[aY]);let aZ=()=>{let a={},b=!0,c=document.getElementById("title"),d=document.getElementById("author"),e=document.getElementById("imageUrl"),f=document.getElementById("pdfUrl");return c?.value?.trim()||(a.title="Vui lòng nhập tiêu đề sách",b=!1),d?.value?.trim()||(a.author="Vui lòng nhập tên tác giả",b=!1),aR||(a.category="Vui lòng chọn thể loại",b=!1),e?.value?.trim()||aJ||(a.imageUrl="Vui lòng tải ảnh bìa hoặc nhập URL ảnh",b=!1),f?.value?.trim()||aH||(a.pdfUrl="Vui lòng tải file PDF hoặc nhập URL PDF",b=!1),aU(a),b},[a$,a_,a0]=(0,c.useActionState)(async(a,b)=>aZ()?await w(b):{success:!1,error:"Vui lòng điền đầy đủ thông tin bắt buộc"},null),[a1,a2,a3]=(0,c.useActionState)(async(a,b)=>I?await x(I,b):{success:!1,error:"Book ID is required"},null);(0,c.useEffect)(()=>{if(a$){let a=JSON.stringify(a$)+Date.now();aW.current!==a&&(aW.current=a,a$.success?(p.toast.success("Thêm sách thành công!"),al().then(()=>{F.refresh(),ba(),setTimeout(()=>{aW.current=null},100)})):a$.error&&p.toast.error("Đã có lỗi xảy ra khi thêm sách."))}},[a$]),(0,c.useEffect)(()=>{if(a1){let a=JSON.stringify(a1)+Date.now();aX.current!==a&&(aX.current=a,a1.success?(p.toast.success("Cập nhật sách thành công!"),al().then(()=>{F.refresh(),ba(),setTimeout(()=>{aX.current=null},100)})):a1.error&&p.toast.error("Đã có lỗi xảy ra khi cập nhật sách."))}},[a1]);let a4=(0,c.useRef)(!0);if((0,c.useEffect)(()=>{if(a4.current){a4.current=!1;return}ah(1)},[$]),v)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!a)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)("button",{onClick:()=>F.push("/login"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:"Đăng nhập với tài khoản Admin"})]})})});let a5=(ag-1)*10,a6=Math.min(a5+10,N),a7=az.length>0?az:Array.from(new Set(L.map(a=>a.category))),a8=async()=>{if(!ar||!av.trim())return void p.toast.error("Vui lòng nhập tên thể loại");try{await aB.mutateAsync({oldCategory:ar,newCategory:av.trim()}),p.toast.success("Cập nhật thể loại thành công!"),as(null),aw("")}catch(a){p.toast.error("Đã có lỗi xảy ra khi cập nhật thể loại.")}},a9=async()=>{if(ax)try{await aC.mutateAsync(ax),p.toast.success("Xóa thể loại thành công!"),ay(null)}catch(a){p.toast.error("Đã có lỗi xảy ra khi xóa thể loại.")}},ba=()=>{aS(""),aV.current?.reset(),aE(""),aG(""),aI(""),aK(""),aM(""),aO(!1),aU({}),F.push("/admin/books")},bb=async(a,b,c,d)=>{try{aQ(!0);let b=new FormData;b.append("file",a),b.append("type",c);let e=(await z.default.post("/api/upload",b,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{if(a.total){let b=Math.round(100*a.loaded/a.total);d?.(b)}}})).data;return d?.(100),"pdf"===c&&e.fileId?(aM(e.fileId),aO(!1),p.toast.info("PDF đang được xử lý, bạn có thể tiếp tục điền thông tin")):p.toast.success("Upload file thành công!"),aQ(!1),e.url}catch(a){return console.error("Error uploading file:",a),p.toast.error("Lỗi khi upload file. Vui lòng thử lại."),aQ(!1),null}},bc=async a=>{ad(!0);let b=1===L.length;try{let c=await y(a);c.success?(await al(),b&&ag>1&&ah(a=>Math.max(1,a-1)),F.refresh(),ab(null),p.toast.success("Xóa sách thành công!")):(p.toast.error(c.error||"Đã có lỗi xảy ra khi xóa sách."),ab(null))}catch(a){console.error("Error deleting book:",a),p.toast.error("Đã có lỗi xảy ra khi xóa sách."),ab(null)}finally{ad(!1)}};return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900",children:"Quản lý sách"}),(0,b.jsx)("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Danh sách và quản lý các đầu sách trên hệ thống"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:20}),(0,b.jsx)(r.Input,{type:"text",placeholder:"Tìm kiếm theo tiêu đề hoặc tác giả...",value:W,onChange:a=>X(a.target.value),onKeyPress:a=>{"Enter"===a.key&&am()},className:"pl-10"})]}),(0,b.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,b.jsxs)(q.Button,{variant:"outline",className:"flex-1 sm:flex-initial cursor-pointer",onClick:am,children:[(0,b.jsx)(h.Search,{size:18}),(0,b.jsx)("span",{className:"ml-2",children:"Tìm kiếm"})]}),(Y||W)&&(0,b.jsxs)(q.Button,{variant:"outline",className:"cursor-pointer",onClick:()=>{X(""),Z(""),ah(1)},title:"Bỏ tìm kiếm",children:[(0,b.jsx)(m.X,{size:18}),(0,b.jsx)("span",{className:"ml-2 hidden sm:inline",children:"Bỏ tìm kiếm"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,b.jsxs)(q.Button,{variant:"outline",onClick:()=>ao(!0),className:"w-full sm:w-auto",children:[(0,b.jsx)(n.Tag,{size:18}),(0,b.jsx)("span",{className:"ml-2",children:"Quản lý thể loại"})]}),(0,b.jsxs)(q.Button,{onClick:()=>F.push("/admin/books?action=create"),className:"w-full sm:w-auto",children:[(0,b.jsx)(i.Plus,{size:18}),(0,b.jsx)("span",{className:"ml-2",children:"Thêm sách mới"})]})]})]}),(0,b.jsxs)(E.Card,{children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(B.Table,{children:[(0,b.jsx)(B.TableHeader,{children:(0,b.jsxs)(B.TableRow,{children:[(0,b.jsx)(B.TableHead,{className:"w-16 sm:w-20",children:"Ảnh bìa"}),(0,b.jsx)(B.TableHead,{children:"Thông tin sách"}),(0,b.jsx)(B.TableHead,{className:"hidden md:table-cell",children:"Ngày thêm"}),(0,b.jsx)(B.TableHead,{className:"hidden sm:table-cell",children:"Lượt xem"}),(0,b.jsx)(B.TableHead,{className:"hidden lg:table-cell",children:"Trạng thái"}),(0,b.jsx)(B.TableHead,{className:"text-right",children:"Hành động"})]})}),(0,b.jsx)(B.TableBody,{children:R?(0,b.jsx)(B.TableRow,{children:(0,b.jsx)(B.TableCell,{colSpan:6,className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-slate-500",children:"Đang tải..."})})}):0===L.length?(0,b.jsx)(B.TableRow,{children:(0,b.jsx)(B.TableCell,{colSpan:6,className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-slate-500",children:"Không có sách nào"})})}):L.map(a=>(0,b.jsxs)(B.TableRow,{children:[(0,b.jsx)(B.TableCell,{children:(0,b.jsx)("div",{className:"w-10 h-14 sm:w-12 sm:h-16 bg-slate-200 rounded overflow-hidden",children:(0,b.jsx)("img",{src:a.coverUrl,alt:a.title,className:"w-full h-full object-cover"})})}),(0,b.jsx)(B.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-medium text-slate-900 text-sm sm:text-base",children:a.title}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 mt-1",children:a.author}),(0,b.jsx)(D.Badge,{variant:"secondary",className:"mt-1 text-xs",children:a.category})]})}),(0,b.jsx)(B.TableCell,{className:"text-xs sm:text-sm text-slate-600 hidden md:table-cell",children:new Date(a.publishDate).toLocaleDateString("vi-VN")}),(0,b.jsx)(B.TableCell,{className:"text-xs sm:text-sm text-slate-600 hidden sm:table-cell",children:a.views||0}),(0,b.jsx)(B.TableCell,{className:"hidden lg:table-cell",children:(0,b.jsx)(D.Badge,{variant:"outline",className:"bg-green-100 text-green-700 border-green-200 text-xs",children:"Đã xuất bản"})}),(0,b.jsx)(B.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",title:"Xem",onClick:()=>af(a),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(j.Eye,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",title:"Sửa",onClick:()=>F.push(`/admin/books?action=edit&id=${a.id}`),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(k.Edit,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:()=>ab(a.id),title:"Xóa",className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(l.Trash2,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})]})})]},a.id))})]})}),(0,b.jsxs)("div",{className:"px-4 sm:px-6 py-4 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,b.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 text-center sm:text-left",children:N>0?(0,b.jsxs)(b.Fragment,{children:["Hiển thị ",a5+1,"-",a6," trên ",N," kết quả"]}):(0,b.jsx)(b.Fragment,{children:"Không có kết quả"})}),P>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Button,{variant:"outline",size:"icon",disabled:1===ag,onClick:()=>ah(a=>Math.max(1,a-1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"←"}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:P},(a,b)=>b+1).map(a=>1===a||a===P||a>=ag-1&&a<=ag+1?(0,b.jsx)(q.Button,{size:"sm",variant:ag===a?"default":"outline",onClick:()=>ah(a),className:"h-8 px-3 sm:h-9 sm:px-4 cursor-pointer ",children:a},a):a===ag-2||a===ag+2?(0,b.jsx)("span",{className:"px-2 text-slate-500",children:"..."},a):null)}),(0,b.jsx)(q.Button,{variant:"outline",size:"icon",disabled:ag===P,onClick:()=>ah(a=>Math.min(P,a+1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"→"})]})]})]}),(0,b.jsx)(C.Dialog,{open:J,onOpenChange:a=>!a&&!a0&&!a3&&ba(),children:(0,b.jsxs)(C.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:K?"Chỉnh sửa sách":"Thêm sách mới"}),(0,b.jsx)(C.DialogDescription,{children:K?"Cập nhật thông tin sách trong hệ thống":"Điền thông tin để thêm sách mới vào hệ thống"})]}),(0,b.jsxs)("form",{ref:aV,action:K?a2:a_,className:"space-y-4",onSubmit:a=>{K||aZ()||(a.preventDefault(),p.toast.error("Vui lòng điền đầy đủ thông tin bắt buộc"))},children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"title",children:"Tiêu đề sách *"}),(0,b.jsx)(r.Input,{id:"title",name:"title",type:"text",required:!0,defaultValue:aY?.title||"",placeholder:"Ví dụ: Đắc Nhân Tâm",onChange:()=>{aT.title&&aU(a=>({...a,title:void 0}))}}),aT.title&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:aT.title})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"author",children:"Tác giả *"}),(0,b.jsx)(r.Input,{id:"author",name:"author",type:"text",required:!0,defaultValue:aY?.author||"",placeholder:"Tên tác giả",onChange:()=>{aT.author&&aU(a=>({...a,author:void 0}))}}),aT.author&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:aT.author})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"description",children:"Mô tả ngắn"}),(0,b.jsx)(s.Textarea,{id:"description",name:"description",defaultValue:aY?.description||"",rows:4,placeholder:"Nhập mô tả về nội dung sách..."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"category",children:"Thể loại *"}),(0,b.jsx)("input",{type:"hidden",name:"category",id:"category-hidden",value:aR,onChange:()=>{}}),(0,b.jsxs)(A.Select,{value:aR,onValueChange:a=>{aS(a);let b=document.getElementById("category-hidden");b&&(b.value=a),aT.category&&aU(a=>({...a,category:void 0}))},children:[(0,b.jsx)(A.SelectTrigger,{id:"category",className:aT.category?"border-red-500":"",children:(0,b.jsx)(A.SelectValue,{placeholder:"Chọn thể loại..."})}),(0,b.jsx)(A.SelectContent,{children:a7.map(a=>(0,b.jsx)(A.SelectItem,{value:a,children:a},a))})]}),aT.category&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:aT.category})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"imageUrl",children:"Ảnh bìa *"}),(0,b.jsx)(u.default,{maxFiles:1,maxSize:5242880,accept:"image/*",multiple:!1,onFilesChange:async a=>{if(a.length>0){let b=a[0],c=b.file;if("completed"===b.status){"url"in c&&c.url?(aE(c.url),aK(c.url)):c instanceof File&&aJ&&aE(aJ),aT.imageUrl&&aU(a=>({...a,imageUrl:void 0}));return}if(c instanceof File&&"uploading"===b.status)aE(URL.createObjectURL(c)),bb(c,b.id,"image",a=>{let c=window.__updateCardUploadProgress;c&&"function"==typeof c&&c(b.id,a)}).then(a=>{if(a){aK(a);let b=document.getElementById("imageUrl");b&&(b.value=a),aT.imageUrl&&aU(a=>({...a,imageUrl:void 0}))}}).catch(a=>{console.error("Upload error:",a)});else if("url"in c&&c.url){aE(c.url),aK(c.url);let a=document.getElementById("imageUrl");a&&(a.value=c.url),aT.imageUrl&&aU(a=>({...a,imageUrl:void 0}))}}else aK(""),aE("")},simulateUpload:!1,onUploadProgress:()=>{}}),(0,b.jsx)(r.Input,{id:"imageUrl",name:"imageUrl",type:"text",value:aJ,onChange:a=>{aK(a.target.value),aT.imageUrl&&a.target.value.trim()&&aU(a=>({...a,imageUrl:void 0}))},placeholder:"Hoặc nhập URL ảnh",className:`mt-2 ${aT.imageUrl?"border-red-500":""}`}),aT.imageUrl&&(0,b.jsx)("p",{className:"text-sm text-red-500 mt-1",children:aT.imageUrl})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"pdfUrl",children:"Tệp sách (PDF/EPUB) *"}),(0,b.jsx)(u.default,{maxFiles:1,maxSize:0x3200000,accept:".pdf,.epub,application/pdf,application/epub+zip",multiple:!1,onFilesChange:async a=>{if(a.length>0){let b=a[0],c=b.file;if("completed"===b.status){"url"in c&&c.url?(aG(c.url),aI(c.url)):c instanceof File&&aH&&aG(aH),aT.pdfUrl&&aU(a=>({...a,pdfUrl:void 0}));return}if(c instanceof File&&"uploading"===b.status)aG(URL.createObjectURL(c)),bb(c,b.id,"pdf",a=>{let c=window.__updateCardUploadProgress;c&&"function"==typeof c&&c(b.id,a)}).then(a=>{if(a){aI(a);let b=document.getElementById("pdfUrl");b&&(b.value=a),aT.pdfUrl&&aU(a=>({...a,pdfUrl:void 0}))}}).catch(a=>{console.error("Upload error:",a)});else if("url"in c&&c.url){aG(c.url),aI(c.url);let a=document.getElementById("pdfUrl");a&&(a.value=c.url),aT.pdfUrl&&aU(a=>({...a,pdfUrl:void 0}))}}else aI(""),aG("")},simulateUpload:!1,onUploadProgress:()=>{}}),(0,b.jsx)(r.Input,{id:"pdfUrl",name:"pdfUrl",type:"text",value:aH,onChange:a=>{aI(a.target.value),aT.pdfUrl&&a.target.value.trim()&&aU(a=>({...a,pdfUrl:void 0}))},placeholder:"Hoặc nhập URL file PDF/EPUB",className:`mt-2 ${aT.pdfUrl?"border-red-500":""}`}),aT.pdfUrl&&(0,b.jsx)("p",{className:"text-sm text-red-500 mt-1",children:aT.pdfUrl})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(q.Button,{type:"button",variant:"outline",onClick:ba,disabled:a0||a3,children:"Hủy bỏ"}),(0,b.jsx)(q.Button,{type:"submit",disabled:a0||a3||aP||!!aL&&!aN,title:aL&&!aN?"Vui lòng đợi PDF xử lý xong":"",children:a0||a3?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),K?"Đang cập nhật...":"Đang lưu..."]}):K?"Cập nhật":"Lưu sách"})]})]})]})}),(0,b.jsx)(C.Dialog,{open:!!ae,onOpenChange:a=>!a&&af(null),children:(0,b.jsxs)(C.DialogContent,{className:"w-[95vw] sm:w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Thông tin sách"}),(0,b.jsx)(C.DialogDescription,{children:"Chi tiết thông tin của sách"})]}),ae&&(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-6",children:[(0,b.jsx)("div",{className:"w-full sm:w-48 h-64 bg-slate-200 rounded-lg overflow-hidden shrink-0",children:(0,b.jsx)("img",{src:ae.coverUrl,alt:ae.title,className:"w-full h-full object-cover"})}),(0,b.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:ae.title}),(0,b.jsxs)("p",{className:"text-lg text-slate-600",children:["Tác giả: ",(0,b.jsx)("span",{className:"font-medium",children:ae.author})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(D.Badge,{variant:"secondary",children:ae.category}),(0,b.jsxs)(D.Badge,{variant:"outline",children:["Ngày: ",new Date(ae.publishDate).toLocaleDateString("vi-VN")]}),(0,b.jsxs)(D.Badge,{variant:"outline",children:["Lượt xem: ",ae.views]}),(0,b.jsxs)(D.Badge,{variant:"outline",children:["Bình luận: ",ae.comments.length]})]}),ae.pdfUrl&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"File PDF:"}),(0,b.jsx)("a",{href:ae.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline text-sm break-all",children:ae.pdfUrl})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-slate-900 mb-2",children:"Mô tả"}),(0,b.jsx)("p",{className:"text-slate-700 leading-relaxed whitespace-pre-line",children:ae.description||"Chưa có mô tả"})]}),ae.comments.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold text-slate-900 mb-3",children:["Bình luận (",ae.comments.length,")"]}),(0,b.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:ae.comments.map(a=>(0,b.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"font-medium text-slate-900",children:a.user}),(0,b.jsx)("span",{className:"text-xs text-slate-500",children:a.date})]}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:a.content})]},a.id))})]})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>af(null),children:"Đóng"}),ae&&(0,b.jsx)(q.Button,{asChild:!0,children:(0,b.jsx)(o.default,{href:`/books/${ae.id}`,target:"_blank",children:"Xem trang chi tiết"})})]})]})}),(0,b.jsx)(C.Dialog,{open:!!aa,onOpenChange:a=>!a&&!ac&&ab(null),children:(0,b.jsxs)(C.DialogContent,{children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Xác nhận xóa"}),(0,b.jsx)(C.DialogDescription,{children:"Bạn có chắc chắn muốn xóa sách này? Hành động này không thể hoàn tác."})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>ab(null),disabled:ac,children:"Hủy"}),(0,b.jsx)(q.Button,{variant:"destructive",onClick:()=>aa&&bc(aa),disabled:ac,children:ac?"Đang xóa...":"Xóa"})]})]})}),(0,b.jsx)(C.Dialog,{open:an&&!ap,onOpenChange:a=>{a||ap||ao(!1)},children:(0,b.jsxs)(C.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Quản lý thể loại"}),(0,b.jsx)(C.DialogDescription,{children:"Xem, thêm, sửa và xóa các thể loại sách"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[(0,b.jsxs)("h3",{className:"font-semibold text-sm sm:text-base",children:["Danh sách thể loại (",az.length,")"]}),(0,b.jsxs)(q.Button,{onClick:()=>aq(!0),className:"w-full sm:w-auto",children:[(0,b.jsx)(i.Plus,{size:18}),(0,b.jsx)("span",{className:"ml-2",children:"Thêm thể loại"})]})]}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===az.length?(0,b.jsx)("p",{className:"text-sm text-slate-500 text-center py-8",children:"Chưa có thể loại nào"}):az.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-slate-50",children:ar===a?(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-1",children:[(0,b.jsx)(r.Input,{value:av,onChange:a=>aw(a.target.value),className:"flex-1",onKeyDown:a=>{"Enter"===a.key&&a8(),"Escape"===a.key&&(as(null),aw(""))}}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(q.Button,{size:"sm",onClick:a8,className:"flex-1 sm:flex-initial",children:"Lưu"}),(0,b.jsx)(q.Button,{size:"sm",variant:"outline",onClick:()=>{as(null),aw("")},className:"flex-1 sm:flex-initial",children:"Hủy"})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"font-medium text-sm sm:text-base truncate flex-1",children:a}),(0,b.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,b.jsx)(q.Button,{size:"sm",variant:"ghost",onClick:()=>{as(a),aw(a)},className:"h-8 w-8 p-0",children:(0,b.jsx)(k.Edit,{size:16})}),(0,b.jsx)(q.Button,{size:"sm",variant:"ghost",onClick:()=>ay(a),className:"h-8 w-8 p-0",children:(0,b.jsx)(l.Trash2,{size:16})})]})]})},a))})]}),(0,b.jsx)(C.DialogFooter,{children:(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>ao(!1),children:"Đóng"})})]})}),(0,b.jsx)(C.Dialog,{open:!!ax,onOpenChange:a=>!a&&ay(null),children:(0,b.jsxs)(C.DialogContent,{children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Xác nhận xóa thể loại"}),(0,b.jsxs)(C.DialogDescription,{children:['Bạn có chắc chắn muốn xóa thể loại "',ax,'"? Hành động này không thể hoàn tác.']})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>ay(null),children:"Hủy"}),(0,b.jsx)(q.Button,{variant:"destructive",onClick:a9,children:"Xóa"})]})]})}),(0,b.jsx)(C.Dialog,{open:ap,onOpenChange:a=>{a||(aq(!1),au(""))},children:(0,b.jsxs)(C.DialogContent,{children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"Thêm thể loại mới"}),(0,b.jsx)(C.DialogDescription,{children:"Nhập tên thể loại mới để thêm vào hệ thống"})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(t.Label,{htmlFor:"newCategory",children:"Tên thể loại"}),(0,b.jsx)(r.Input,{id:"newCategory",type:"text",value:at,onChange:a=>au(a.target.value),placeholder:"Ví dụ: Văn Học, Nghệ Thuật...",onKeyDown:async a=>{if("Enter"===a.key&&at.trim())try{await aA.mutateAsync(at.trim()),p.toast.success("Thêm thể loại thành công!"),au(""),aq(!1)}catch(a){p.toast.error("Đã có lỗi xảy ra khi thêm thể loại.")}}})]})}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(q.Button,{variant:"outline",onClick:()=>{aq(!1),au("")},children:"Hủy"}),(0,b.jsx)(q.Button,{onClick:async()=>{if(!at.trim())return void p.toast.error("Vui lòng nhập tên thể loại");try{await aA.mutateAsync(at.trim()),p.toast.success("Thêm thể loại thành công!"),au(""),aq(!1)}catch(a){p.toast.error("Đã có lỗi xảy ra khi thêm thể loại.")}},disabled:aA.isPending,children:aA.isPending?"Đang thêm...":"Thêm thể loại"})]})]})})]})})}function G(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})}),children:(0,b.jsx)(F,{})})}a.s(["default",()=>G],13082)}];

//# sourceMappingURL=Desktop_nguyenvanhieu-bookapp_src_app_admin_books_page_tsx_bb5a521d._.js.map