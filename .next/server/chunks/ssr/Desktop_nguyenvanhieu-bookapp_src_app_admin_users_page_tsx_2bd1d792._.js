module.exports=[20812,a=>{"use strict";var b=a.i(51112),c=a.i(14206),d=a.i(7879),e=a.i(59485),f=a.i(67759),g=a.i(7283),h=a.i(46948),i=a.i(10758);let j=(0,a.i(38808).default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var k=a.i(53140),l=a.i(10152),m=a.i(71728),n=a.i(63405),o=a.i(13218),p=a.i(91140),q=a.i(43216),r=a.i(30935),s=a.i(46919),t=a.i(3272),u=a.i(51998),v=a.i(34386),w=a.i(86453);let x=(0,w.createServerReference)("40e2d9199694012429548d5f721ca0eef3518d2ef0",w.callServer,void 0,w.findSourceMapURL,"updateUserAction");var y=a.i(56575);function z(){var a;let{isAdmin:w,isLoading:z,user:A,refreshUser:B}=(0,e.useAuth)(),C=(0,f.useRouter)(),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)({email:"",name:"",avatar:"",password:"",confirmPassword:"",role:"user"}),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),T=N.password?{minLength:(a=N.password).length>=8,hasUpperCase:/[A-Z]/.test(a),hasLowerCase:/[a-z]/.test(a),hasNumber:/[0-9]/.test(a),hasSpecialChar:/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(a)}:null,U=!!T&&Object.values(T).every(a=>!0===a);(0,c.useEffect)(()=>{let a=async()=>{G(!0);try{let a=await fetch("/api/users");if(!a.ok)throw Error("Failed to fetch users");let b=await a.json();E(b)}catch(a){console.error("Error fetching users:",a),m.toast.error("Không thể tải danh sách người dùng")}finally{G(!1)}};w&&a()},[w]);let V=async a=>{try{M(!0);let b=new FormData;b.append("file",a),b.append("type","image");let c=(await y.default.post("/api/upload",b,{headers:{"Content-Type":"multipart/form-data"}})).data;return m.toast.success("Upload ảnh đại diện thành công!"),M(!1),c.url}catch(a){return console.error("Error uploading avatar:",a),m.toast.error("Lỗi khi upload ảnh đại diện. Vui lòng thử lại."),M(!1),null}},W=async a=>{let b=a.target.files?.[0];if(!b)return;if(!b.type.startsWith("image/"))return void m.toast.error("Vui lòng chọn file ảnh");if(b.size>2097152)return void m.toast.error("Kích thước ảnh không được vượt quá 2MB");let c=await V(b);c&&O(a=>({...a,avatar:c}))},X=async()=>{if(H){if(""!==N.password.trim()){if(!U)return void m.toast.error("Mật khẩu không đủ mạnh. Vui lòng kiểm tra các yêu cầu bên dưới.");if(N.password!==N.confirmPassword)return void m.toast.error("Mật khẩu xác nhận không khớp")}K(!0);try{let a=new FormData;a.append("id",H.id),a.append("email",N.email),a.append("name",N.name),a.append("avatar",N.avatar),a.append("role",N.role),""!==N.password.trim()&&a.append("password",N.password);let b=await x(a);if(b.success){m.toast.success("Cập nhật thông tin người dùng thành công!"),I(null);let a=await fetch("/api/users");if(a.ok){let b=await a.json();E(b)}A&&H.id===A.id&&await B()}else m.toast.error(b.error||"Đã có lỗi xảy ra khi cập nhật người dùng.")}catch(a){console.error("Error updating user:",a),m.toast.error("Đã có lỗi xảy ra khi cập nhật người dùng.")}finally{K(!1)}}};return z?(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})}):w?(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Người dùng"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Quản lý người dùng hệ thống"})]}),(0,b.jsx)(t.Card,{children:(0,b.jsx)("div",{className:"p-4 sm:p-6",children:(0,b.jsxs)(r.Table,{children:[(0,b.jsx)(r.TableHeader,{children:(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableHead,{children:"Người dùng"}),(0,b.jsx)(r.TableHead,{className:"hidden md:table-cell",children:"Email"}),(0,b.jsx)(r.TableHead,{className:"hidden lg:table-cell",children:"Vai trò"}),(0,b.jsx)(r.TableHead,{className:"text-right",children:"Hành động"})]})}),(0,b.jsx)(r.TableBody,{children:F?(0,b.jsx)(r.TableRow,{children:(0,b.jsx)(r.TableCell,{colSpan:4,className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-slate-500",children:"Đang tải..."})})}):0===D.length?(0,b.jsx)(r.TableRow,{children:(0,b.jsx)(r.TableCell,{colSpan:4,className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-slate-500",children:"Chưa có người dùng nào"})})}):D.map(a=>(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(u.Avatar,{className:"h-10 w-10",children:[(0,b.jsx)(u.AvatarImage,{src:a.avatar,alt:a.name||a.email}),(0,b.jsx)(u.AvatarFallback,{children:a.name?a.name.charAt(0).toUpperCase():a.email.charAt(0).toUpperCase()})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:a.name||"Chưa có tên"}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:a.email})]})]})}),(0,b.jsx)(r.TableCell,{className:"hidden md:table-cell",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Mail,{className:"h-4 w-4 text-slate-400"}),(0,b.jsx)("span",{className:"text-sm text-slate-600",children:a.email})]})}),(0,b.jsx)(r.TableCell,{className:"hidden lg:table-cell",children:(0,b.jsx)(s.Badge,{variant:"admin"===a.role?"default":"secondary",children:"admin"===a.role?"Quản trị viên":"Người dùng"})}),(0,b.jsx)(r.TableCell,{children:(0,b.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:()=>{I(a),O({email:a.email,name:a.name||"",avatar:a.avatar||"",password:"",confirmPassword:"",role:a.role||"user"}),Q(!1),S(!1)},title:"Chỉnh sửa",className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,b.jsx)(g.Edit,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})})})]},a.id))})]})})}),(0,b.jsx)(q.Dialog,{open:!!H,onOpenChange:a=>!a&&I(null),children:(0,b.jsxs)(q.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Chỉnh sửa người dùng"}),(0,b.jsx)(q.DialogDescription,{children:"Cập nhật thông tin, mật khẩu hoặc ảnh đại diện của người dùng"})]}),H&&(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Ảnh đại diện"}),(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(u.Avatar,{className:"h-24 w-24 border-2 border-slate-200",children:[(0,b.jsx)(u.AvatarImage,{src:N.avatar,alt:N.name||N.email}),(0,b.jsx)(u.AvatarFallback,{className:"bg-blue-100 text-blue-600 text-xl font-semibold",children:N.name?N.name.charAt(0).toUpperCase():N.email.charAt(0).toUpperCase()})]}),N.avatar&&(0,b.jsx)("button",{type:"button",onClick:()=>O(a=>({...a,avatar:""})),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Xóa ảnh",children:(0,b.jsx)(l.X,{className:"h-3 w-3"})})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)("label",{className:"flex-1 cursor-pointer",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:W,className:"hidden",disabled:L}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 px-4 py-2 border border-slate-300 rounded-md hover:bg-slate-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,b.jsx)(k.Upload,{className:"h-4 w-4 text-slate-600"}),(0,b.jsx)("span",{className:"text-sm text-slate-700",children:L?"Đang tải...":"Chọn ảnh"})]})]})}),(0,b.jsx)(o.Input,{type:"text",value:N.avatar,onChange:a=>O(b=>({...b,avatar:a.target.value})),placeholder:"Hoặc nhập URL ảnh đại diện",disabled:L}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Kích thước tối đa: 2MB. Định dạng: JPG, PNG, GIF"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{htmlFor:"email",children:"Email *"}),(0,b.jsx)(o.Input,{id:"email",type:"email",value:N.email,onChange:a=>O(b=>({...b,email:a.target.value})),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{htmlFor:"name",children:"Tên"}),(0,b.jsx)(o.Input,{id:"name",type:"text",value:N.name,onChange:a=>O(b=>({...b,name:a.target.value})),placeholder:"Nhập tên người dùng"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{htmlFor:"password",children:"Mật khẩu mới"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Input,{id:"password",type:P?"text":"password",value:N.password,onChange:a=>O(b=>({...b,password:a.target.value})),placeholder:"Để trống nếu không muốn đổi mật khẩu",className:`pr-10 ${N.password&&!U?"border-red-300 focus-visible:border-red-500":""}`}),(0,b.jsx)("button",{type:"button",onClick:()=>Q(!P),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",title:P?"Ẩn mật khẩu":"Hiện mật khẩu",children:P?(0,b.jsx)(j,{className:"h-4 w-4"}):(0,b.jsx)(i.Eye,{className:"h-4 w-4"})})]}),N.password&&(0,b.jsxs)("div",{className:"space-y-1.5 p-3 bg-slate-50 rounded-md border border-slate-200",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-slate-700 mb-2",children:"Yêu cầu mật khẩu mạnh:"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${T?.minLength?"bg-green-500":"bg-slate-300"}`,children:T?.minLength&&(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("span",{className:T?.minLength?"text-green-700":"text-slate-600",children:"Ít nhất 8 ký tự"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${T?.hasUpperCase?"bg-green-500":"bg-slate-300"}`,children:T?.hasUpperCase&&(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("span",{className:T?.hasUpperCase?"text-green-700":"text-slate-600",children:"Có chữ hoa (A-Z)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${T?.hasLowerCase?"bg-green-500":"bg-slate-300"}`,children:T?.hasLowerCase&&(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("span",{className:T?.hasLowerCase?"text-green-700":"text-slate-600",children:"Có chữ thường (a-z)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${T?.hasNumber?"bg-green-500":"bg-slate-300"}`,children:T?.hasNumber&&(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("span",{className:T?.hasNumber?"text-green-700":"text-slate-600",children:"Có số (0-9)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full flex items-center justify-center ${T?.hasSpecialChar?"bg-green-500":"bg-slate-300"}`,children:T?.hasSpecialChar&&(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("span",{className:T?.hasSpecialChar?"text-green-700":"text-slate-600",children:"Có ký tự đặc biệt (!@#$%^&*...)"})]})]})]}),!N.password&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Chỉ nhập mật khẩu mới nếu muốn thay đổi"})]}),""!==N.password.trim()&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{htmlFor:"confirmPassword",children:"Xác nhận mật khẩu"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Input,{id:"confirmPassword",type:R?"text":"password",value:N.confirmPassword,onChange:a=>O(b=>({...b,confirmPassword:a.target.value})),placeholder:"Nhập lại mật khẩu để xác nhận",className:"pr-10"}),(0,b.jsx)("button",{type:"button",onClick:()=>S(!R),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",title:R?"Ẩn mật khẩu":"Hiện mật khẩu",children:R?(0,b.jsx)(j,{className:"h-4 w-4"}):(0,b.jsx)(i.Eye,{className:"h-4 w-4"})})]}),N.confirmPassword&&N.password!==N.confirmPassword&&(0,b.jsx)("p",{className:"text-xs text-red-500",children:"Mật khẩu xác nhận không khớp"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{htmlFor:"role",children:"Vai trò"}),(0,b.jsxs)(v.Select,{value:N.role,onValueChange:a=>O(b=>({...b,role:a})),children:[(0,b.jsx)(v.SelectTrigger,{id:"role",children:(0,b.jsx)(v.SelectValue,{})}),(0,b.jsxs)(v.SelectContent,{children:[(0,b.jsx)(v.SelectItem,{value:"user",children:"Người dùng"}),(0,b.jsx)(v.SelectItem,{value:"admin",children:"Quản trị viên"})]})]})]})]}),(0,b.jsxs)(q.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>I(null),disabled:J||L,children:"Hủy"}),(0,b.jsx)(n.Button,{onClick:X,disabled:J||L||!N.email,children:J||L?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Đang lưu..."]}):"Lưu thay đổi"})]})]})})]})}):(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)(n.Button,{onClick:()=>C.push("/login"),children:"Đăng nhập với tài khoản Admin"})]})})})}a.s(["default",()=>z],20812)}];

//# sourceMappingURL=Desktop_nguyenvanhieu-bookapp_src_app_admin_users_page_tsx_2bd1d792._.js.map