module.exports=[24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},24836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},63024,a=>{"use strict";var b=a.i(14206),c=a.i(32139),d=a.i(21413),e=a.i(51354),f=a.i(26639);let g=["article-categories"];async function h(){let a=await fetch("/api/article-categories");if(!a.ok)throw Error("Failed to fetch article categories");return a.json()}async function i(a){let b=await fetch("/api/article-categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:a})});if(!b.ok)throw Error((await b.json().catch(()=>({error:"Failed to create article category"}))).error||"Failed to create article category")}async function j({oldCategory:a,newCategory:b}){let c=await fetch("/api/article-categories",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldCategory:a,newCategory:b})});if(!c.ok)throw Error((await c.json().catch(()=>({error:"Failed to update article category"}))).error||"Failed to update article category")}async function k(a){let b=await fetch(`/api/article-categories?category=${encodeURIComponent(a)}`,{method:"DELETE"});if(!b.ok)throw Error((await b.json().catch(()=>({error:"Failed to delete article category"}))).error||"Failed to delete article category")}function l(){let{setArticleCategories:a}=(0,f.useDataStore)(),d=(0,c.useQuery)({queryKey:g,queryFn:h});return b.default.useEffect(()=>{d.data&&a(d.data)},[d.data,a]),d}function m(){let a=(0,e.useQueryClient)(),{addArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:i,onSuccess:(c,d)=>{b(d),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to create article category:",a)}})}function n(){let a=(0,e.useQueryClient)(),{updateArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:j,onSuccess:(c,d)=>{b(d.oldCategory,d.newCategory),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to update article category:",a)}})}function o(){let a=(0,e.useQueryClient)(),{deleteArticleCategory:b}=(0,f.useDataStore)();return(0,d.useMutation)({mutationFn:k,onSuccess:(c,d)=>{b(d),a.invalidateQueries({queryKey:g})},onError:a=>{console.error("Failed to delete article category:",a)}})}a.s(["useArticleCategories",()=>l,"useCreateArticleCategory",()=>m,"useDeleteArticleCategory",()=>o,"useUpdateArticleCategory",()=>n])},75390,a=>{"use strict";var b=a.i(14206),c=a.i(32139),d=a.i(26639);let e={all:["articles"],lists:()=>[...e.all,"list"],list:a=>[...e.lists(),{filters:a}],details:()=>[...e.all,"detail"],detail:a=>[...e.details(),a]};async function f(){let a=await fetch("/api/articles");if(!a.ok)throw Error("Failed to fetch articles");return a.json()}async function g(a){let b=new URLSearchParams;a.page&&b.append("page",a.page.toString()),a.limit&&b.append("limit",a.limit.toString()),a.search&&b.append("search",a.search),a.category&&b.append("category",a.category),a.status&&b.append("status",a.status);let c=await fetch(`/api/articles?${b.toString()}`);if(!c.ok)throw Error("Failed to fetch articles");return c.json()}function h(){let{setArticles:a}=(0,d.useDataStore)(),g=(0,c.useQuery)({queryKey:e.all,queryFn:f});return b.default.useEffect(()=>{g.data&&a(g.data)},[g.data,a]),g}function i(a){return(0,c.useQuery)({queryKey:[...e.all,"paginated",a],queryFn:()=>g(a)})}a.s(["useArticles",()=>h,"useArticlesPaginated",()=>i])},388,a=>{"use strict";let b=(0,a.i(38808).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],388)},48136,a=>{"use strict";var b=a.i(51112),c=a.i(14206),d=a.i(7879),e=a.i(88011),f=a.i(59485),g=a.i(67759),h=a.i(388),i=a.i(77015),j=a.i(10152),k=a.i(63405),l=a.i(13218),m=a.i(95499),n=a.i(91140),o=a.i(34386),p=a.i(88783),q=a.i(14609),r=a.i(71728),s=a.i(56575);function t(){let{updateArticle:a}=(0,e.useData)(),{isAdmin:t,isLoading:u}=(0,f.useAuth)(),v=(0,g.useRouter)(),w=(0,g.useParams)().id,[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("published"),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!0),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)({}),{articleCategories:R}=(0,e.useData)();(0,c.useEffect)(()=>{w&&(async()=>{M(!0);try{let a=await fetch("/api/articles");if(!a.ok)throw Error("Failed to fetch article");let b=(await a.json()).find(a=>a.id===w);b?(y(b.title),A(b.category||""),C(b.summary||""),E(b.content||""),G(b.imageUrl||""),I(b.status||"published")):(r.toast.error("Không tìm thấy bài viết"),v.push("/admin/articles"))}catch(a){console.error("Error fetching article:",a),r.toast.error("Không thể tải bài viết"),v.push("/admin/articles")}finally{M(!1)}})()},[w,v]);let S=async(a,b,c,d)=>{try{O(!0);let b=new FormData;b.append("file",a),b.append("type",c);let e=(await s.default.post("/api/upload",b,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{if(a.total){let b=Math.round(100*a.loaded/a.total);d?.(b)}}})).data;d?.(100);let f=e.url||e.secureUrl;return G(f),r.toast.success("Upload ảnh thành công!"),O(!1),f}catch(a){return console.error("Error uploading file:",a),r.toast.error("Lỗi khi upload ảnh. Vui lòng thử lại."),O(!1),null}};if(u||L)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!t)return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,b.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,b.jsx)(k.Button,{onClick:()=>v.push("/login"),children:"Đăng nhập với tài khoản Admin"})]})})});let T=async b=>{let c;if(b.preventDefault(),c={},x&&x.trim()||(c.title="Tiêu đề bài viết là bắt buộc"),D&&D.trim()&&"<p></p>"!==D||(c.content="Nội dung bài viết là bắt buộc"),F&&F.trim()||(c.imageUrl="Hình ảnh bài viết là bắt buộc"),z&&z.trim()||(c.category="Chuyên mục là bắt buộc"),Q(c),0!==Object.keys(c).length)return void r.toast.error("Vui lòng điền đầy đủ các trường bắt buộc");K(!0);try{if(!(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:w,title:x.trim(),summary:B.trim()||void 0,content:D.trim(),imageUrl:F.trim(),category:z.trim(),status:H})})).ok)throw Error("Failed to update article");await a(w,{title:x.trim(),summary:B.trim()||void 0,content:D.trim(),imageUrl:F.trim(),category:z.trim(),status:H}),r.toast.success("Cập nhật bài viết thành công!"),v.push("/admin/articles")}catch(a){console.error("Error updating article:",a),r.toast.error("Đã có lỗi xảy ra khi cập nhật bài viết.")}finally{K(!1)}},U=async()=>{if(x||D||B||F)try{(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:w,title:x.trim()||void 0,summary:B.trim()||void 0,content:D.trim()||void 0,imageUrl:F.trim()||void 0,category:z.trim()||void 0,status:"draft"})})).ok&&(await a(w,{status:"draft"}),r.toast.success("Đã lưu bản nháp!"))}catch(a){console.error("Error saving draft:",a),r.toast.error("Không thể lưu bản nháp")}v.push("/admin/articles")};return(0,b.jsx)(d.AdminLayout,{children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",onClick:U,children:(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Chỉnh sửa bài viết"}),(0,b.jsx)("p",{className:"text-slate-600 mt-1",children:"Cập nhật thông tin và nội dung bài viết"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:U,disabled:J||N,children:[(0,b.jsx)(j.X,{className:"h-4 w-4 mr-2"}),"Hủy"]}),(0,b.jsxs)(k.Button,{onClick:T,disabled:J||N,children:[(0,b.jsx)(i.Save,{className:"h-4 w-4 mr-2"}),J?"Đang lưu...":N?"Đang upload...":"Lưu bài viết"]})]})]}),(0,b.jsx)("form",{onSubmit:T,className:"space-y-6",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"title",children:"Tiêu đề bài viết *"}),(0,b.jsx)(l.Input,{id:"title",type:"text",required:!0,value:x,onChange:a=>{y(a.target.value),P.title&&Q(a=>({...a,title:""}))},placeholder:"Nhập tiêu đề bài viết...",className:`text-lg ${P.title?"border-red-500":""}`}),P.title&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:P.title})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"content",children:"Nội dung bài viết *"}),(0,b.jsx)("div",{className:P.content?"border border-red-500 rounded-md":"",children:(0,b.jsx)(q.RichTextEditor,{content:D,onChange:a=>{E(a),P.content&&Q(a=>({...a,content:""}))},placeholder:"Nhập nội dung bài viết...",className:"min-h-[500px]"})}),P.content&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:P.content})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"category",children:"Chuyên mục *"}),(0,b.jsxs)(o.Select,{value:z,onValueChange:a=>{A(a),P.category&&Q(a=>({...a,category:""}))},children:[(0,b.jsx)(o.SelectTrigger,{id:"category",className:P.category?"border-red-500":"",children:(0,b.jsx)(o.SelectValue,{placeholder:"Chọn chuyên mục..."})}),(0,b.jsx)(o.SelectContent,{children:R.map(a=>(0,b.jsx)(o.SelectItem,{value:a,children:a},a))})]}),P.category&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:P.category})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"summary",children:"Mô tả ngắn"}),(0,b.jsx)(m.Textarea,{id:"summary",value:B,onChange:a=>C(a.target.value),rows:4,placeholder:"Nhập mô tả ngắn về bài viết..."}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Mô tả này sẽ được hiển thị trong danh sách bài viết"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n.Label,{htmlFor:"image",children:"Hình ảnh bài viết *"}),(0,b.jsx)(p.default,{maxFiles:1,maxSize:5242880,accept:"image/*",multiple:!1,onFilesChange:async a=>{if(a.length>0){let b=a[0],c=b.file;if("completed"===b.status)return void("url"in c&&c.url?(G(c.url),P.imageUrl&&Q(a=>({...a,imageUrl:""}))):c instanceof File&&F&&(G(F),P.imageUrl&&Q(a=>({...a,imageUrl:""}))));c instanceof File&&"uploading"===b.status?await S(c,b.id,"image",a=>{let c=window.__updateCardUploadProgress;c&&"function"==typeof c&&c(b.id,a)})&&P.imageUrl&&Q(a=>({...a,imageUrl:""})):"url"in c&&c.url&&(G(c.url),P.imageUrl&&Q(a=>({...a,imageUrl:""})))}else G("")},simulateUpload:!1,onUploadProgress:(a,b)=>{}}),(0,b.jsx)(l.Input,{id:"image",type:"text",value:F,onChange:a=>{G(a.target.value),P.imageUrl&&Q(a=>({...a,imageUrl:""}))},placeholder:"Hoặc nhập URL hình ảnh",className:`mt-2 ${P.imageUrl?"border-red-500":""}`}),P.imageUrl&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:P.imageUrl})]})]})]})})]})})}a.s(["default",()=>t])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d3e4547d._.js.map