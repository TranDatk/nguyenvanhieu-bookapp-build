(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52166,e=>{"use strict";var t=e.i(70470),l=e.i(90223),s=e.i(60617),a=e.i(36241),n=e.i(44184),i=e.i(92658),r=e.i(84578),c=e.i(22740),o=e.i(25839),h=e.i(42861),d=e.i(16137),m=e.i(17994),u=e.i(19863),x=e.i(81950),g=e.i(65604),p=e.i(84783),j=e.i(72533),f=e.i(65506),v=e.i(83884),y=e.i(71455),b=e.i(66942);let N=(0,b.createServerReference)("407ecf12c804068b0acae738e49f73023347cb9b0a",b.callServer,void 0,b.findSourceMapURL,"createBook"),w=(0,b.createServerReference)("604b980b60b58ab032f17f7b4f87b3a8e32648c277",b.callServer,void 0,b.findSourceMapURL,"updateBookAction"),C=(0,b.createServerReference)("402f039846ffe44b8cfe03247bdc88955d19119d31",b.callServer,void 0,b.findSourceMapURL,"deleteBookAction");var k=e.i(4712),U=e.i(2860),S=e.i(59609),D=e.i(92852),T=e.i(16206),B=e.i(90981);function F(){let{isAdmin:e,isLoading:b}=(0,a.useAuth)(),F=(0,i.useRouter)(),L=(0,i.useSearchParams)(),E=L.get("action"),R=L.get("id"),z="create"===E||"edit"===E,H="edit"===E&&R,[P,I]=(0,l.useState)([]),[V,A]=(0,l.useState)(0),[O,X]=(0,l.useState)(0),[M,K]=(0,l.useState)(!0),q=L.get("search")||"",$=L.get("category")||"all",_=(()=>{let e=L.get("page");if(e){let t=parseInt(e,10);return!isNaN(t)&&t>0?t:1}return 1})(),[Q,J]=(0,l.useState)(q),[G,W]=(0,l.useState)(q),[Y,Z]=(0,l.useState)($),[ee,et]=(0,l.useState)(null),[el,es]=(0,l.useState)(!1),[ea,en]=(0,l.useState)(null),[ei,er]=(0,l.useState)(_),ec=(0,l.useRef)(!1),eo=(0,l.useRef)(!0);(0,l.useEffect)(()=>{if(ec.current){ec.current=!1;return}let e=L.get("search")||"",t=L.get("category")||"all",l=L.get("page");if(e!==G&&(J(e),W(e)),t!==Y&&Z(t),l){let e=parseInt(l,10);!isNaN(e)&&e>0&&e!==ei&&er(e)}else 1===ei||eo.current||er(1)},[L]);let eh=l.default.useCallback(e=>{let t=new URLSearchParams(L.toString());E&&t.set("action",E),R&&t.set("id",R),void 0!==e.search&&(e.search?t.set("search",e.search):t.delete("search")),void 0!==e.category&&(e.category&&"all"!==e.category?t.set("category",e.category):t.delete("category")),void 0!==e.page&&(e.page>1?t.set("page",e.page.toString()):t.delete("page")),F.replace(`/admin/books?${t.toString()}`,{scroll:!1})},[L,F,E,R]),ed=l.default.useCallback(async()=>{K(!0);try{let e=new URLSearchParams({page:ei.toString(),limit:"10"});G&&e.append("search",G),Y&&"all"!==Y&&e.append("category",Y);let t=await fetch(`/api/books?${e.toString()}`);if(!t.ok)throw Error("Failed to fetch books");let l=await t.json();I(l.books||[]),A(l.total||0),X(l.totalPages||0)}catch(e){console.error("Error fetching books:",e),g.toast.error("Không thể tải danh sách sách")}finally{K(!1)}},[ei,G,Y]);(0,l.useEffect)(()=>{ed()},[ed]),(0,l.useEffect)(()=>{if(eo.current){eo.current=!1;return}ec.current=!0,eh({search:G,category:Y,page:ei})},[ei,G,Y]);let em=()=>{W(Q),er(1)},[eu,ex]=(0,l.useState)(!1),[eg,ep]=(0,l.useState)(!1),[ej,ef]=(0,l.useState)(null),[ev,ey]=(0,l.useState)(""),[eb,eN]=(0,l.useState)(""),[ew,eC]=(0,l.useState)(null),{data:ek=[]}=(0,n.useBookCategories)(),eU=(0,n.useCreateBookCategory)(),eS=(0,n.useUpdateBookCategory)(),eD=(0,n.useDeleteBookCategory)(),[eT,eB]=(0,l.useState)(""),[eF,eL]=(0,l.useState)(""),[eE,eR]=(0,l.useState)(""),[ez,eH]=(0,l.useState)(""),[eP,eI]=(0,l.useState)(""),[eV,eA]=(0,l.useState)(!1),[eO,eX]=(0,l.useState)(!1),[eM,eK]=(0,l.useState)(""),[eq,e$]=(0,l.useState)({}),e_=(0,l.useRef)(null),eQ=(0,l.useRef)(null),eJ=(0,l.useRef)(null);(0,l.useEffect)(()=>{eQ.current=null,eJ.current=null},[z]);let eG=H&&R?P.find(e=>e.id===R):null;(0,l.useEffect)(()=>{eG?(eH(eG.coverUrl||""),eR(eG.pdfUrl||""),eB(eG.coverUrl||""),eL(eG.pdfUrl||""),eK(eG.category||"")):(eH(""),eR(""),eB(""),eL(""),eK(""))},[eG]);let eW=()=>{let e={},t=!0,l=document.getElementById("title"),s=document.getElementById("author"),a=document.getElementById("imageUrl"),n=document.getElementById("pdfUrl");return l?.value?.trim()||(e.title="Vui lòng nhập tiêu đề sách",t=!1),s?.value?.trim()||(e.author="Vui lòng nhập tên tác giả",t=!1),eM||(e.category="Vui lòng chọn thể loại",t=!1),a?.value?.trim()||ez||(e.imageUrl="Vui lòng tải ảnh bìa hoặc nhập URL ảnh",t=!1),n?.value?.trim()||eE||(e.pdfUrl="Vui lòng tải file PDF hoặc nhập URL PDF",t=!1),e$(e),t},[eY,eZ,e0]=(0,l.useActionState)(async(e,t)=>eW()?await N(t):{success:!1,error:"Vui lòng điền đầy đủ thông tin bắt buộc"},null),[e1,e2,e8]=(0,l.useActionState)(async(e,t)=>R?await w(R,t):{success:!1,error:"Book ID is required"},null);(0,l.useEffect)(()=>{if(eY){let e=JSON.stringify(eY)+Date.now();eQ.current!==e&&(eQ.current=e,eY.success?(g.toast.success("Thêm sách thành công!"),ed().then(()=>{F.refresh(),te(),setTimeout(()=>{eQ.current=null},100)})):eY.error&&g.toast.error("Đã có lỗi xảy ra khi thêm sách."))}},[eY]),(0,l.useEffect)(()=>{if(e1){let e=JSON.stringify(e1)+Date.now();eJ.current!==e&&(eJ.current=e,e1.success?(g.toast.success("Cập nhật sách thành công!"),ed().then(()=>{F.refresh(),te(),setTimeout(()=>{eJ.current=null},100)})):e1.error&&g.toast.error("Đã có lỗi xảy ra khi cập nhật sách."))}},[e1]);let e6=(0,l.useRef)(!0);if((0,l.useEffect)(()=>{if(e6.current){e6.current=!1;return}er(1)},[Y]),b)return(0,t.jsx)(s.AdminLayout,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!e)return(0,t.jsx)(s.AdminLayout,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,t.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,t.jsx)("button",{onClick:()=>F.push("/login"),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:"Đăng nhập với tài khoản Admin"})]})})});let e4=(ei-1)*10,e5=Math.min(e4+10,V),e9=ek.length>0?ek:Array.from(new Set(P.map(e=>e.category))),e3=async()=>{if(!ej||!eb.trim())return void g.toast.error("Vui lòng nhập tên thể loại");try{await eS.mutateAsync({oldCategory:ej,newCategory:eb.trim()}),g.toast.success("Cập nhật thể loại thành công!"),ef(null),eN("")}catch(e){g.toast.error("Đã có lỗi xảy ra khi cập nhật thể loại.")}},e7=async()=>{if(ew)try{await eD.mutateAsync(ew),g.toast.success("Xóa thể loại thành công!"),eC(null)}catch(e){g.toast.error("Đã có lỗi xảy ra khi xóa thể loại.")}},te=()=>{eK(""),e_.current?.reset(),eB(""),eL(""),eR(""),eH(""),eI(""),eA(!1),e$({}),F.push("/admin/books")},tt=async(e,t,l,s)=>{try{eX(!0);let t=new FormData;t.append("file",e),t.append("type",l);let a=(await k.default.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total){let t=Math.round(100*e.loaded/e.total);s?.(t)}}})).data;return s?.(100),"pdf"===l?(eI(a.publicId||""),eA(!0),g.toast.success("Upload PDF thành công!")):g.toast.success("Upload file thành công!"),eX(!1),a.url}catch(e){return console.error("Error uploading file:",e),g.toast.error("Lỗi khi upload file. Vui lòng thử lại."),eX(!1),null}},tl=async e=>{es(!0);let t=1===P.length;try{let l=await C(e);l.success?(await ed(),t&&ei>1&&er(e=>Math.max(1,e-1)),F.refresh(),et(null),g.toast.success("Xóa sách thành công!")):(g.toast.error(l.error||"Đã có lỗi xảy ra khi xóa sách."),et(null))}catch(e){console.error("Error deleting book:",e),g.toast.error("Đã có lỗi xảy ra khi xóa sách."),et(null)}finally{es(!1)}};return(0,t.jsx)(s.AdminLayout,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-900",children:"Quản lý sách"}),(0,t.jsx)("p",{className:"text-sm sm:text-base text-slate-600 mt-1",children:"Danh sách và quản lý các đầu sách trên hệ thống"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(r.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10",size:20}),(0,t.jsx)(j.Input,{type:"text",placeholder:"Tìm kiếm theo tiêu đề hoặc tác giả...",value:Q,onChange:e=>J(e.target.value),onKeyPress:e=>{"Enter"===e.key&&em()},className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,t.jsxs)(p.Button,{variant:"outline",className:"flex-1 sm:flex-initial cursor-pointer",onClick:em,children:[(0,t.jsx)(r.Search,{size:18}),(0,t.jsx)("span",{className:"ml-2",children:"Tìm kiếm"})]}),(G||Q)&&(0,t.jsxs)(p.Button,{variant:"outline",className:"cursor-pointer",onClick:()=>{J(""),W(""),er(1)},title:"Bỏ tìm kiếm",children:[(0,t.jsx)(m.X,{size:18}),(0,t.jsx)("span",{className:"ml-2 hidden sm:inline",children:"Bỏ tìm kiếm"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,t.jsxs)(p.Button,{variant:"outline",onClick:()=>ex(!0),className:"w-full sm:w-auto",children:[(0,t.jsx)(u.Tag,{size:18}),(0,t.jsx)("span",{className:"ml-2",children:"Quản lý thể loại"})]}),(0,t.jsxs)(p.Button,{onClick:()=>F.push("/admin/books?action=create"),className:"w-full sm:w-auto",children:[(0,t.jsx)(c.Plus,{size:18}),(0,t.jsx)("span",{className:"ml-2",children:"Thêm sách mới"})]})]})]}),(0,t.jsxs)(B.Card,{children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(S.Table,{children:[(0,t.jsx)(S.TableHeader,{children:(0,t.jsxs)(S.TableRow,{children:[(0,t.jsx)(S.TableHead,{className:"w-16 sm:w-20",children:"Ảnh bìa"}),(0,t.jsx)(S.TableHead,{children:"Thông tin sách"}),(0,t.jsx)(S.TableHead,{className:"hidden md:table-cell",children:"Ngày thêm"}),(0,t.jsx)(S.TableHead,{className:"hidden sm:table-cell",children:"Lượt xem"}),(0,t.jsx)(S.TableHead,{className:"hidden lg:table-cell",children:"Trạng thái"}),(0,t.jsx)(S.TableHead,{className:"text-right",children:"Hành động"})]})}),(0,t.jsx)(S.TableBody,{children:M?(0,t.jsx)(S.TableRow,{children:(0,t.jsx)(S.TableCell,{colSpan:6,className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-slate-500",children:"Đang tải..."})})}):0===P.length?(0,t.jsx)(S.TableRow,{children:(0,t.jsx)(S.TableCell,{colSpan:6,className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-slate-500",children:"Không có sách nào"})})}):P.map(e=>(0,t.jsxs)(S.TableRow,{children:[(0,t.jsx)(S.TableCell,{children:(0,t.jsx)("div",{className:"w-10 h-14 sm:w-12 sm:h-16 bg-slate-200 rounded overflow-hidden",children:(0,t.jsx)("img",{src:e.coverUrl,alt:e.title,className:"w-full h-full object-cover"})})}),(0,t.jsx)(S.TableCell,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-slate-900 text-sm sm:text-base",children:e.title}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 mt-1",children:e.author}),(0,t.jsx)(T.Badge,{variant:"secondary",className:"mt-1 text-xs",children:e.category})]})}),(0,t.jsx)(S.TableCell,{className:"text-xs sm:text-sm text-slate-600 hidden md:table-cell",children:new Date(e.publishDate).toLocaleDateString("vi-VN")}),(0,t.jsx)(S.TableCell,{className:"text-xs sm:text-sm text-slate-600 hidden sm:table-cell",children:e.views||0}),(0,t.jsx)(S.TableCell,{className:"hidden lg:table-cell",children:(0,t.jsx)(T.Badge,{variant:"outline",className:"bg-green-100 text-green-700 border-green-200 text-xs",children:"Đã xuất bản"})}),(0,t.jsx)(S.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1 sm:gap-2",children:[(0,t.jsx)(p.Button,{variant:"ghost",size:"icon",title:"Xem",onClick:()=>en(e),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,t.jsx)(o.Eye,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,t.jsx)(p.Button,{variant:"ghost",size:"icon",title:"Sửa",onClick:()=>F.push(`/admin/books?action=edit&id=${e.id}`),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,t.jsx)(h.Edit,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),(0,t.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>et(e.id),title:"Xóa",className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,t.jsx)(d.Trash2,{size:16,className:"sm:w-[18px] sm:h-[18px]"})})]})})]},e.id))})]})}),(0,t.jsxs)("div",{className:"px-4 sm:px-6 py-4 border-t border-slate-200 flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,t.jsx)("p",{className:"text-xs sm:text-sm text-slate-600 text-center sm:text-left",children:V>0?(0,t.jsxs)(t.Fragment,{children:["Hiển thị ",e4+1,"-",e5," trên ",V," kết quả"]}):(0,t.jsx)(t.Fragment,{children:"Không có kết quả"})}),O>1&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Button,{variant:"outline",size:"icon",disabled:1===ei,onClick:()=>er(e=>Math.max(1,e-1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"←"}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:O},(e,t)=>t+1).map(e=>1===e||e===O||e>=ei-1&&e<=ei+1?(0,t.jsx)(p.Button,{size:"sm",variant:ei===e?"default":"outline",onClick:()=>er(e),className:"h-8 px-3 sm:h-9 sm:px-4 cursor-pointer ",children:e},e):e===ei-2||e===ei+2?(0,t.jsx)("span",{className:"px-2 text-slate-500",children:"..."},e):null)}),(0,t.jsx)(p.Button,{variant:"outline",size:"icon",disabled:ei===O,onClick:()=>er(e=>Math.min(O,e+1)),className:"h-8 w-8 sm:h-9 sm:w-9 cursor-pointer",children:"→"})]})]})]}),(0,t.jsx)(D.Dialog,{open:z,onOpenChange:e=>!e&&!e0&&!e8&&te(),children:(0,t.jsxs)(D.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:H?"Chỉnh sửa sách":"Thêm sách mới"}),(0,t.jsx)(D.DialogDescription,{children:H?"Cập nhật thông tin sách trong hệ thống":"Điền thông tin để thêm sách mới vào hệ thống"})]}),(0,t.jsxs)("form",{ref:e_,action:H?e2:eZ,className:"space-y-4",onSubmit:e=>{H||eW()||(e.preventDefault(),g.toast.error("Vui lòng điền đầy đủ thông tin bắt buộc"))},children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"title",children:"Tiêu đề sách *"}),(0,t.jsx)(j.Input,{id:"title",name:"title",type:"text",required:!0,defaultValue:eG?.title||"",placeholder:"Ví dụ: Đắc Nhân Tâm",onChange:()=>{eq.title&&e$(e=>({...e,title:void 0}))}}),eq.title&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:eq.title})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"author",children:"Tác giả *"}),(0,t.jsx)(j.Input,{id:"author",name:"author",type:"text",required:!0,defaultValue:eG?.author||"",placeholder:"Tên tác giả",onChange:()=>{eq.author&&e$(e=>({...e,author:void 0}))}}),eq.author&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:eq.author})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"description",children:"Mô tả ngắn"}),(0,t.jsx)(f.Textarea,{id:"description",name:"description",defaultValue:eG?.description||"",rows:4,placeholder:"Nhập mô tả về nội dung sách..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"category",children:"Thể loại *"}),(0,t.jsx)("input",{type:"hidden",name:"category",id:"category-hidden",value:eM,onChange:()=>{}}),(0,t.jsxs)(U.Select,{value:eM,onValueChange:e=>{eK(e);let t=document.getElementById("category-hidden");t&&(t.value=e),eq.category&&e$(e=>({...e,category:void 0}))},children:[(0,t.jsx)(U.SelectTrigger,{id:"category",className:eq.category?"border-red-500":"",children:(0,t.jsx)(U.SelectValue,{placeholder:"Chọn thể loại..."})}),(0,t.jsx)(U.SelectContent,{children:e9.map(e=>(0,t.jsx)(U.SelectItem,{value:e,children:e},e))})]}),eq.category&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:eq.category})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"imageUrl",children:"Ảnh bìa *"}),(0,t.jsx)(y.default,{maxFiles:1,maxSize:5242880,accept:"image/*",multiple:!1,onFilesChange:async e=>{if(e.length>0){let t=e[0],l=t.file;if("completed"===t.status){"url"in l&&l.url?(eB(l.url),eH(l.url)):l instanceof File&&ez&&eB(ez),eq.imageUrl&&e$(e=>({...e,imageUrl:void 0}));return}if(l instanceof File&&"uploading"===t.status)eB(URL.createObjectURL(l)),tt(l,t.id,"image",e=>{let l=window.__updateCardUploadProgress;l&&"function"==typeof l&&l(t.id,e)}).then(e=>{if(e){eH(e);let t=document.getElementById("imageUrl");t&&(t.value=e),eq.imageUrl&&e$(e=>({...e,imageUrl:void 0}))}}).catch(e=>{console.error("Upload error:",e)});else if("url"in l&&l.url){eB(l.url),eH(l.url);let e=document.getElementById("imageUrl");e&&(e.value=l.url),eq.imageUrl&&e$(e=>({...e,imageUrl:void 0}))}}else eH(""),eB("")},simulateUpload:!1,onUploadProgress:()=>{}}),(0,t.jsx)(j.Input,{id:"imageUrl",name:"imageUrl",type:"text",value:ez,onChange:e=>{eH(e.target.value),eq.imageUrl&&e.target.value.trim()&&e$(e=>({...e,imageUrl:void 0}))},placeholder:"Hoặc nhập URL ảnh",className:`mt-2 ${eq.imageUrl?"border-red-500":""}`}),eq.imageUrl&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:eq.imageUrl})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"pdfUrl",children:"Tệp sách (PDF/EPUB) *"}),(0,t.jsx)(y.default,{maxFiles:1,maxSize:0x3200000,accept:".pdf,.epub,application/pdf,application/epub+zip",multiple:!1,onFilesChange:async e=>{if(e.length>0){let t=e[0],l=t.file;if("completed"===t.status){"url"in l&&l.url?(eL(l.url),eR(l.url)):l instanceof File&&eE&&eL(eE),eq.pdfUrl&&e$(e=>({...e,pdfUrl:void 0}));return}if(l instanceof File&&"uploading"===t.status)eL(URL.createObjectURL(l)),tt(l,t.id,"pdf",e=>{let l=window.__updateCardUploadProgress;l&&"function"==typeof l&&l(t.id,e)}).then(e=>{if(e){eR(e);let t=document.getElementById("pdfUrl");t&&(t.value=e),eq.pdfUrl&&e$(e=>({...e,pdfUrl:void 0}))}}).catch(e=>{console.error("Upload error:",e)});else if("url"in l&&l.url){eL(l.url),eR(l.url);let e=document.getElementById("pdfUrl");e&&(e.value=l.url),eq.pdfUrl&&e$(e=>({...e,pdfUrl:void 0}))}}else eR(""),eL("")},simulateUpload:!1,onUploadProgress:()=>{}}),(0,t.jsx)(j.Input,{id:"pdfUrl",name:"pdfUrl",type:"text",value:eE,onChange:e=>{eR(e.target.value),eq.pdfUrl&&e.target.value.trim()&&e$(e=>({...e,pdfUrl:void 0}))},placeholder:"Hoặc nhập URL file PDF/EPUB",className:`mt-2 ${eq.pdfUrl?"border-red-500":""}`}),eq.pdfUrl&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-1",children:eq.pdfUrl})]}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(p.Button,{type:"button",variant:"outline",onClick:te,disabled:e0||e8,children:"Hủy bỏ"}),(0,t.jsx)(p.Button,{type:"submit",disabled:e0||e8||eO,children:e0||e8?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),H?"Đang cập nhật...":"Đang lưu..."]}):H?"Cập nhật":"Lưu sách"})]})]})]})}),(0,t.jsx)(D.Dialog,{open:!!ea,onOpenChange:e=>!e&&en(null),children:(0,t.jsxs)(D.DialogContent,{className:"w-[95vw] sm:w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"Thông tin sách"}),(0,t.jsx)(D.DialogDescription,{children:"Chi tiết thông tin của sách"})]}),ea&&(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-6",children:[(0,t.jsx)("div",{className:"w-full sm:w-48 h-64 bg-slate-200 rounded-lg overflow-hidden shrink-0",children:(0,t.jsx)("img",{src:ea.coverUrl,alt:ea.title,className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:ea.title}),(0,t.jsxs)("p",{className:"text-lg text-slate-600",children:["Tác giả: ",(0,t.jsx)("span",{className:"font-medium",children:ea.author})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(T.Badge,{variant:"secondary",children:ea.category}),(0,t.jsxs)(T.Badge,{variant:"outline",children:["Ngày: ",new Date(ea.publishDate).toLocaleDateString("vi-VN")]}),(0,t.jsxs)(T.Badge,{variant:"outline",children:["Lượt xem: ",ea.views]}),(0,t.jsxs)(T.Badge,{variant:"outline",children:["Bình luận: ",ea.comments.length]})]}),ea.pdfUrl&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-slate-600 mb-1",children:"File PDF:"}),(0,t.jsx)("a",{href:ea.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline text-sm break-all",children:ea.pdfUrl})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-slate-900 mb-2",children:"Mô tả"}),(0,t.jsx)("p",{className:"text-slate-700 leading-relaxed whitespace-pre-line",children:ea.description||"Chưa có mô tả"})]}),ea.comments.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-semibold text-slate-900 mb-3",children:["Bình luận (",ea.comments.length,")"]}),(0,t.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:ea.comments.map(e=>(0,t.jsxs)("div",{className:"bg-slate-50 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-slate-900",children:e.user}),(0,t.jsx)("span",{className:"text-xs text-slate-500",children:e.date})]}),(0,t.jsx)("p",{className:"text-sm text-slate-700",children:e.content})]},e.id))})]})]}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>en(null),children:"Đóng"}),ea&&(0,t.jsx)(p.Button,{asChild:!0,children:(0,t.jsx)(x.default,{href:`/books/${ea.id}`,target:"_blank",children:"Xem trang chi tiết"})})]})]})}),(0,t.jsx)(D.Dialog,{open:!!ee,onOpenChange:e=>!e&&!el&&et(null),children:(0,t.jsxs)(D.DialogContent,{children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"Xác nhận xóa"}),(0,t.jsx)(D.DialogDescription,{children:"Bạn có chắc chắn muốn xóa sách này? Hành động này không thể hoàn tác."})]}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>et(null),disabled:el,children:"Hủy"}),(0,t.jsx)(p.Button,{variant:"destructive",onClick:()=>ee&&tl(ee),disabled:el,children:el?"Đang xóa...":"Xóa"})]})]})}),(0,t.jsx)(D.Dialog,{open:eu&&!eg,onOpenChange:e=>{e||eg||ex(!1)},children:(0,t.jsxs)(D.DialogContent,{className:"w-[95vw] sm:w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"Quản lý thể loại"}),(0,t.jsx)(D.DialogDescription,{children:"Xem, thêm, sửa và xóa các thể loại sách"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[(0,t.jsxs)("h3",{className:"font-semibold text-sm sm:text-base",children:["Danh sách thể loại (",ek.length,")"]}),(0,t.jsxs)(p.Button,{onClick:()=>ep(!0),className:"w-full sm:w-auto",children:[(0,t.jsx)(c.Plus,{size:18}),(0,t.jsx)("span",{className:"ml-2",children:"Thêm thể loại"})]})]}),(0,t.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===ek.length?(0,t.jsx)("p",{className:"text-sm text-slate-500 text-center py-8",children:"Chưa có thể loại nào"}):ek.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-slate-50",children:ej===e?(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 flex-1",children:[(0,t.jsx)(j.Input,{value:eb,onChange:e=>eN(e.target.value),className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&e3(),"Escape"===e.key&&(ef(null),eN(""))}}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(p.Button,{size:"sm",onClick:e3,className:"flex-1 sm:flex-initial",children:"Lưu"}),(0,t.jsx)(p.Button,{size:"sm",variant:"outline",onClick:()=>{ef(null),eN("")},className:"flex-1 sm:flex-initial",children:"Hủy"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"font-medium text-sm sm:text-base truncate flex-1",children:e}),(0,t.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,t.jsx)(p.Button,{size:"sm",variant:"ghost",onClick:()=>{ef(e),eN(e)},className:"h-8 w-8 p-0",children:(0,t.jsx)(h.Edit,{size:16})}),(0,t.jsx)(p.Button,{size:"sm",variant:"ghost",onClick:()=>eC(e),className:"h-8 w-8 p-0",children:(0,t.jsx)(d.Trash2,{size:16})})]})]})},e))})]}),(0,t.jsx)(D.DialogFooter,{children:(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>ex(!1),children:"Đóng"})})]})}),(0,t.jsx)(D.Dialog,{open:!!ew,onOpenChange:e=>!e&&eC(null),children:(0,t.jsxs)(D.DialogContent,{children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"Xác nhận xóa thể loại"}),(0,t.jsxs)(D.DialogDescription,{children:['Bạn có chắc chắn muốn xóa thể loại "',ew,'"? Hành động này không thể hoàn tác.']})]}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>eC(null),children:"Hủy"}),(0,t.jsx)(p.Button,{variant:"destructive",onClick:e7,children:"Xóa"})]})]})}),(0,t.jsx)(D.Dialog,{open:eg,onOpenChange:e=>{e||(ep(!1),ey(""))},children:(0,t.jsxs)(D.DialogContent,{children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"Thêm thể loại mới"}),(0,t.jsx)(D.DialogDescription,{children:"Nhập tên thể loại mới để thêm vào hệ thống"})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(v.Label,{htmlFor:"newCategory",children:"Tên thể loại"}),(0,t.jsx)(j.Input,{id:"newCategory",type:"text",value:ev,onChange:e=>ey(e.target.value),placeholder:"Ví dụ: Văn Học, Nghệ Thuật...",onKeyDown:async e=>{if("Enter"===e.key&&ev.trim())try{await eU.mutateAsync(ev.trim()),g.toast.success("Thêm thể loại thành công!"),ey(""),ep(!1)}catch(e){g.toast.error("Đã có lỗi xảy ra khi thêm thể loại.")}}})]})}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>{ep(!1),ey("")},children:"Hủy"}),(0,t.jsx)(p.Button,{onClick:async()=>{if(!ev.trim())return void g.toast.error("Vui lòng nhập tên thể loại");try{await eU.mutateAsync(ev.trim()),g.toast.success("Thêm thể loại thành công!"),ey(""),ep(!1)}catch(e){g.toast.error("Đã có lỗi xảy ra khi thêm thể loại.")}},disabled:eU.isPending,children:eU.isPending?"Đang thêm...":"Thêm thể loại"})]})]})})]})})}function L(){return(0,t.jsx)(l.Suspense,{fallback:(0,t.jsx)(s.AdminLayout,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})}),children:(0,t.jsx)(F,{})})}e.s(["default",()=>L],52166)}]);