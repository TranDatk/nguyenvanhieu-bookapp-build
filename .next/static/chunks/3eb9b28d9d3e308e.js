(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,30651,e=>{"use strict";var t=e.i(90223),a=e.i(79353),r=e.i(29898),i=e.i(98177),s=e.i(13354);let l=["article-categories"];async function n(){let e=await fetch("/api/article-categories");if(!e.ok)throw Error("Failed to fetch article categories");return e.json()}async function c(e){let t=await fetch("/api/article-categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:e})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to create article category"}))).error||"Failed to create article category")}async function o({oldCategory:e,newCategory:t}){let a=await fetch("/api/article-categories",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldCategory:e,newCategory:t})});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Failed to update article category"}))).error||"Failed to update article category")}async function d(e){let t=await fetch(`/api/article-categories?category=${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to delete article category"}))).error||"Failed to delete article category")}function u(){let{setArticleCategories:e}=(0,s.useDataStore)(),r=(0,a.useQuery)({queryKey:l,queryFn:n});return t.default.useEffect(()=>{r.data&&e(r.data)},[r.data,e]),r}function h(){let e=(0,i.useQueryClient)(),{addArticleCategory:t}=(0,s.useDataStore)();return(0,r.useMutation)({mutationFn:c,onSuccess:(a,r)=>{t(r),e.invalidateQueries({queryKey:l})},onError:e=>{console.error("Failed to create article category:",e)}})}function m(){let e=(0,i.useQueryClient)(),{updateArticleCategory:t}=(0,s.useDataStore)();return(0,r.useMutation)({mutationFn:o,onSuccess:(a,r)=>{t(r.oldCategory,r.newCategory),e.invalidateQueries({queryKey:l})},onError:e=>{console.error("Failed to update article category:",e)}})}function g(){let e=(0,i.useQueryClient)(),{deleteArticleCategory:t}=(0,s.useDataStore)();return(0,r.useMutation)({mutationFn:d,onSuccess:(a,r)=>{t(r),e.invalidateQueries({queryKey:l})},onError:e=>{console.error("Failed to delete article category:",e)}})}e.s(["useArticleCategories",()=>u,"useCreateArticleCategory",()=>h,"useDeleteArticleCategory",()=>g,"useUpdateArticleCategory",()=>m])},15080,e=>{"use strict";var t=e.i(90223),a=e.i(79353),r=e.i(13354);let i={all:["articles"],lists:()=>[...i.all,"list"],list:e=>[...i.lists(),{filters:e}],details:()=>[...i.all,"detail"],detail:e=>[...i.details(),e]};async function s(){let e=await fetch("/api/articles");if(!e.ok)throw Error("Failed to fetch articles");return e.json()}async function l(e){let t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.search&&t.append("search",e.search),e.category&&t.append("category",e.category),e.status&&t.append("status",e.status);let a=await fetch(`/api/articles?${t.toString()}`);if(!a.ok)throw Error("Failed to fetch articles");return a.json()}function n(){let{setArticles:e}=(0,r.useDataStore)(),l=(0,a.useQuery)({queryKey:i.all,queryFn:s});return t.default.useEffect(()=>{l.data&&e(l.data)},[l.data,e]),l}function c(e){return(0,a.useQuery)({queryKey:[...i.all,"paginated",e],queryFn:()=>l(e)})}e.s(["useArticles",()=>n,"useArticlesPaginated",()=>c])},10105,e=>{"use strict";let t=(0,e.i(25578).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],10105)},19471,e=>{"use strict";var t=e.i(70470),a=e.i(90223),r=e.i(60617),i=e.i(28060),s=e.i(36241),l=e.i(92658),n=e.i(10105),c=e.i(89318),o=e.i(17994),d=e.i(84783),u=e.i(72533),h=e.i(65506),m=e.i(83884),g=e.i(2860),p=e.i(71455),y=e.i(95070),x=e.i(65604),f=e.i(4712);function j(){let{updateArticle:e}=(0,i.useData)(),{isAdmin:j,isLoading:v}=(0,s.useAuth)(),b=(0,l.useRouter)(),N=(0,l.useParams)().id,[w,C]=(0,a.useState)(""),[S,U]=(0,a.useState)(""),[F,E]=(0,a.useState)(""),[k,T]=(0,a.useState)(""),[A,L]=(0,a.useState)(""),[P,q]=(0,a.useState)("published"),[D,K]=(0,a.useState)(!1),[Q,O]=(0,a.useState)(!0),[B,M]=(0,a.useState)(!1),[R,H]=(0,a.useState)({}),{articleCategories:I}=(0,i.useData)();(0,a.useEffect)(()=>{N&&(async()=>{O(!0);try{let e=await fetch("/api/articles");if(!e.ok)throw Error("Failed to fetch article");let t=(await e.json()).find(e=>e.id===N);t?(C(t.title),U(t.category||""),E(t.summary||""),T(t.content||""),L(t.imageUrl||""),q(t.status||"published")):(x.toast.error("Không tìm thấy bài viết"),b.push("/admin/articles"))}catch(e){console.error("Error fetching article:",e),x.toast.error("Không thể tải bài viết"),b.push("/admin/articles")}finally{O(!1)}})()},[N,b]);let J=async(e,t,a,r)=>{try{M(!0);let t=new FormData;t.append("file",e),t.append("type",a);let i=(await f.default.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total){let t=Math.round(100*e.loaded/e.total);r?.(t)}}})).data;r?.(100);let s=i.url||i.secureUrl;return L(s),x.toast.success("Upload ảnh thành công!"),M(!1),s}catch(e){return console.error("Error uploading file:",e),x.toast.error("Lỗi khi upload ảnh. Vui lòng thử lại."),M(!1),null}};if(v||Q)return(0,t.jsx)(r.AdminLayout,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-slate-600",children:"Đang tải..."})]})})});if(!j)return(0,t.jsx)(r.AdminLayout,{children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-sm text-center max-w-md",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"Truy cập bị từ chối"}),(0,t.jsx)("p",{className:"text-slate-600 mb-4",children:"Bạn không có quyền truy cập trang này."}),(0,t.jsx)(d.Button,{onClick:()=>b.push("/login"),children:"Đăng nhập với tài khoản Admin"})]})})});let V=async t=>{let a;if(t.preventDefault(),a={},w&&w.trim()||(a.title="Tiêu đề bài viết là bắt buộc"),k&&k.trim()&&"<p></p>"!==k||(a.content="Nội dung bài viết là bắt buộc"),A&&A.trim()||(a.imageUrl="Hình ảnh bài viết là bắt buộc"),S&&S.trim()||(a.category="Chuyên mục là bắt buộc"),H(a),0!==Object.keys(a).length)return void x.toast.error("Vui lòng điền đầy đủ các trường bắt buộc");K(!0);try{if(!(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:N,title:w.trim(),summary:F.trim()||void 0,content:k.trim(),imageUrl:A.trim(),category:S.trim(),status:P})})).ok)throw Error("Failed to update article");await e(N,{title:w.trim(),summary:F.trim()||void 0,content:k.trim(),imageUrl:A.trim(),category:S.trim(),status:P}),x.toast.success("Cập nhật bài viết thành công!"),b.push("/admin/articles")}catch(e){console.error("Error updating article:",e),x.toast.error("Đã có lỗi xảy ra khi cập nhật bài viết.")}finally{K(!1)}},$=async()=>{if(w||k||F||A)try{(await fetch("/api/articles",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:N,title:w.trim()||void 0,summary:F.trim()||void 0,content:k.trim()||void 0,imageUrl:A.trim()||void 0,category:S.trim()||void 0,status:"draft"})})).ok&&(await e(N,{status:"draft"}),x.toast.success("Đã lưu bản nháp!"))}catch(e){console.error("Error saving draft:",e),x.toast.error("Không thể lưu bản nháp")}b.push("/admin/articles")};return(0,t.jsx)(r.AdminLayout,{children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:$,children:(0,t.jsx)(n.ArrowLeft,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Chỉnh sửa bài viết"}),(0,t.jsx)("p",{className:"text-slate-600 mt-1",children:"Cập nhật thông tin và nội dung bài viết"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(d.Button,{variant:"outline",onClick:$,disabled:D||B,children:[(0,t.jsx)(o.X,{className:"h-4 w-4 mr-2"}),"Hủy"]}),(0,t.jsxs)(d.Button,{onClick:V,disabled:D||B,children:[(0,t.jsx)(c.Save,{className:"h-4 w-4 mr-2"}),D?"Đang lưu...":B?"Đang upload...":"Lưu bài viết"]})]})]}),(0,t.jsx)("form",{onSubmit:V,className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"title",children:"Tiêu đề bài viết *"}),(0,t.jsx)(u.Input,{id:"title",type:"text",required:!0,value:w,onChange:e=>{C(e.target.value),R.title&&H(e=>({...e,title:""}))},placeholder:"Nhập tiêu đề bài viết...",className:`text-lg ${R.title?"border-red-500":""}`}),R.title&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:R.title})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"content",children:"Nội dung bài viết *"}),(0,t.jsx)("div",{className:R.content?"border border-red-500 rounded-md":"",children:(0,t.jsx)(y.RichTextEditor,{content:k,onChange:e=>{T(e),R.content&&H(e=>({...e,content:""}))},placeholder:"Nhập nội dung bài viết...",className:"min-h-[500px]"})}),R.content&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:R.content})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"category",children:"Chuyên mục *"}),(0,t.jsxs)(g.Select,{value:S,onValueChange:e=>{U(e),R.category&&H(e=>({...e,category:""}))},children:[(0,t.jsx)(g.SelectTrigger,{id:"category",className:R.category?"border-red-500":"",children:(0,t.jsx)(g.SelectValue,{placeholder:"Chọn chuyên mục..."})}),(0,t.jsx)(g.SelectContent,{children:I.map(e=>(0,t.jsx)(g.SelectItem,{value:e,children:e},e))})]}),R.category&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:R.category})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"summary",children:"Mô tả ngắn"}),(0,t.jsx)(h.Textarea,{id:"summary",value:F,onChange:e=>E(e.target.value),rows:4,placeholder:"Nhập mô tả ngắn về bài viết..."}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Mô tả này sẽ được hiển thị trong danh sách bài viết"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(m.Label,{htmlFor:"image",children:"Hình ảnh bài viết *"}),(0,t.jsx)(p.default,{maxFiles:1,maxSize:5242880,accept:"image/*",multiple:!1,onFilesChange:async e=>{if(e.length>0){let t=e[0],a=t.file;if("completed"===t.status)return void("url"in a&&a.url?(L(a.url),R.imageUrl&&H(e=>({...e,imageUrl:""}))):a instanceof File&&A&&(L(A),R.imageUrl&&H(e=>({...e,imageUrl:""}))));a instanceof File&&"uploading"===t.status?await J(a,t.id,"image",e=>{let a=window.__updateCardUploadProgress;a&&"function"==typeof a&&a(t.id,e)})&&R.imageUrl&&H(e=>({...e,imageUrl:""})):"url"in a&&a.url&&(L(a.url),R.imageUrl&&H(e=>({...e,imageUrl:""})))}else L("")},simulateUpload:!1,onUploadProgress:(e,t)=>{}}),(0,t.jsx)(u.Input,{id:"image",type:"text",value:A,onChange:e=>{L(e.target.value),R.imageUrl&&H(e=>({...e,imageUrl:""}))},placeholder:"Hoặc nhập URL hình ảnh",className:`mt-2 ${R.imageUrl?"border-red-500":""}`}),R.imageUrl&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:R.imageUrl})]})]})]})})]})})}e.s(["default",()=>j])}]);